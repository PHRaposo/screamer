<html lang="en">
<head>
<title>Screamer</title>
<meta http-equiv="Content-Type" content="text/html">
<meta name="description" content="Screamer">
<meta name="generator" content="makeinfo 4.13">
<link title="Top" rel="top" href="#Top">
<link href="http://www.gnu.org/software/texinfo/" rel="generator-home" title="Texinfo Homepage">
<!--
Copyright 2011 Nikodemus Siivola <nikodemus@random-state.net>

This manual is distributed under the same terms as Screamer:

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:

The above copyright and authorship notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

Happy Constraining!-->
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
  pre.display { font-family:inherit }
  pre.format  { font-family:inherit }
  pre.smalldisplay { font-family:inherit; font-size:smaller }
  pre.smallformat  { font-family:inherit; font-size:smaller }
  pre.smallexample { font-size:smaller }
  pre.smalllisp    { font-size:smaller }
  span.sc    { font-variant:small-caps }
  span.roman { font-family:serif; font-weight:normal; } 
  span.sansserif { font-family:sans-serif; font-weight:normal; } 
.node { visibility:hidden; height: 0px; }
 .menu { visibility:hidden; height: 0px; }
 .chapter { background-color:#e4bbff; padding: 0.2em; }
 .section { background-color:#e4bbff; padding: 0.2em; }
 .settitle { background-color:#e4bbff; }
 .contents { border: 2px solid black;
             margin: 1cm 1cm 1cm 1cm;
             padding-left: 3mm; }
 .lisp { padding: 0; margin: 0em; }
 body { padding: 2em 8em; font-family: sans-serif; }
 h1 { padding: 1em; text-align: center; }
 li { margin: 1em; }
--></style>
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3652989-3']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>
</head>
<body>
<h1 class="settitle">Screamer</h1>
<div class="node">
<a name="Top"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Original-Publications">Original Publications</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#dir">(dir)</a>

</div>

<h2 class="unnumbered">Introduction</h2>

<p>Screamer provides a nondeterministic choice-point operator, a
backtracking mechanism, and a forward propagation facility.

   <p>Screamer was originally written by Jeffrey Mark Siskind and David
Allen McAllester.

   <p>The copy of Screamer this documentation refers to is maintained
courtesy of <a href="http://sb-studio.net/">Steel Bank Studio Ltd</a> by
<a href="mailto:nikodemus@sb-studio.net">Nikodemus Siivola</a>.

   <p>The Google Group
<pre class="example">     <a href="http://groups.google.com/group/screamer/">http://groups.google.com/group/screamer/</a>
</pre>
   <p>exists for Screamer-related discussions.

   <p>Screamer is maintained in Git:
<pre class="example">     git clone git://github.com/nikodemus/screamer.git
</pre>
   <p>will get you a local copy.
<pre class="example">     <a href="http://github.com/nikodemus/screamer">http://github.com/nikodemus/screamer</a>
</pre>
   <p>is the GitHub project page.

<div class="contents">
<h2>Table of Contents</h2>
<ul>
<li><a name="toc_Top" href="#Top">Introduction</a>
<li><a name="toc_Original-Publications" href="#Original-Publications">1 Original Publications</a>
<li><a name="toc_Overview" href="#Overview">2 Overview</a>
<ul>
<li><a href="#Overview">2.1 Important Note on Packages</a>
<li><a href="#Overview">2.2 Choice-Points, Failure, and Backtracking</a>
<li><a href="#Overview">2.3 Generators</a>
<li><a href="#Overview">2.4 Side-Effects</a>
<li><a href="#Overview">2.5 Constraint Propagation</a>
<li><a href="#Overview">2.6 Current Limitations</a>
<ul>
<li><a href="#Overview">2.6.1 Not Supported At All</a>
<li><a href="#Overview">2.6.2 Limited Support</a>
<li><a href="#Overview">2.6.3 Limitations in Undoing Side-Effects</a>
</li></ul>
</li></ul>
<li><a name="toc_Examples" href="#Examples">3 Examples</a>
<ul>
<li><a href="#Examples">3.1 Einstein's Riddle</a>
<li><a href="#Examples">3.2 The Zebra Puzzle</a>
<li><a href="#Examples">3.3 The Sudoku Puzzle</a>
</li></ul>
<li><a name="toc_Dictionary" href="#Dictionary">4 Dictionary</a>
<ul>
<li><a href="#Dictionary">4.1 Nondetermism</a>
<li><a href="#Dictionary">4.2 Constraints</a>
<ul>
<li><a href="#Dictionary">4.2.1 Basics</a>
<li><a href="#Dictionary">4.2.2 Booleans</a>
<li><a href="#Dictionary">4.2.3 Sequences</a>
<li><a href="#Dictionary">4.2.4 Numbers</a>
<li><a href="#Dictionary">4.2.5 Forcing Solutions</a>
</li></ul>
<li><a href="#Dictionary">4.3 Miscellany</a>
</li></ul>
<li><a name="toc_Function-Index" href="#Function-Index">Appendix A Function Index</a>
<li><a name="toc_Variable-Index" href="#Variable-Index">Appendix B Variable Index</a>
</li></ul>
</div>

<ul class="menu">
<li><a accesskey="1" href="#Original-Publications">Original Publications</a>
<li><a accesskey="2" href="#Overview">Overview</a>
<li><a accesskey="3" href="#Examples">Examples</a>
<li><a accesskey="4" href="#Dictionary">Dictionary</a>
<li><a accesskey="5" href="#Function-Index">Function Index</a>
<li><a accesskey="6" href="#Variable-Index">Variable Index</a>
</ul>

<!-- MACHINE GENERATED FILE! Do not edit by hand! -->
<!-- See SB-TEXINFO for details. -->
<div class="node">
<a name="Original-Publications"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Overview">Overview</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Top">Top</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h2 class="chapter">1 Original Publications</h2>

<p>Following original publications by Siskind and McAllester form the
basis of this manual:

   <p><a href="http://nikodemus.github.com/screamer/screaming-yellow-zonkers.pdf">Screaming Yellow Zonkers</a>, 1991. Old Screamer manual, doesn't always
hold true for Screamer 3.20 on which this &ldquo;modern&rdquo; Screamer is
based, but still probably the most complete discussion of various
operators and the overall design of Screamer outside of this manual.

   <p><a href="http://nikodemus.github.com/screamer/screamer-paper.pdf">Screamer: A Portable Efficient Implementation of Nondeterministic Common Lisp</a>, 1993. A paper describing the fundamentals of Screamer.

   <p><a href="http://nikodemus.github.com/screamer/nondeterministic-lisp.pdf">Nondeterministic Lisp as a Substrate for Constraint Logic Programming</a>, 1993. A paper describing the constaints propagation
features of Screamer.

<div class="node">
<a name="Overview"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Examples">Examples</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Original-Publications">Original Publications</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h2 class="chapter">2 Overview</h2>

<h3 class="section">2.1 Important Note on Packages</h3>

<p>Screamer shadows <code>defun</code>, and a couple of other symbols.

   <p>Examples in this manual are expected to be entered in the package
<code>SCREAMER-USER</code>, which has the correct <code>defun</code>.

   <p>Packages using Screamer are best defined using
<a href="#Macro-define_002dscreamer_002dpackage"><code>define-screamer-package</code></a>, which is like <code>defpackage</code>
using <code>CL</code> and <code>SCREAMER</code> packages, but does the additional
shadowing imports.

   <p>This is however by no means necessary: you can also explicitly use
<code>screamer::defun</code>.

<h3 class="section">2.2 Choice-Points, Failure, and Backtracking</h3>

<p>Screamer adds nondeterminism by providing the <em>choice-point</em>
operator <a href="#Macro-either"><code>either</code></a> and the <em>failure</em> operator
<a href="#Function-fail"><code>fail</code></a>.

   <p>A choice-point is a point in program where more than one thing can
happen. When a choice-point is encountered, one of the possibilities
occurs, and execution continues. Should a failure subsequently occur,
the system backtracks to the last choice-point where multiple
possibilities were still present, and tries again.

   <p>Backtracking is controlled by a form providing a nondeterministic
context, eg. <a href="#Macro-all_002dvalues"><code>all-values</code></a>, <a href="#Macro-one_002dvalue"><code>one-value</code></a>, or
<a href="#Macro-for_002deffects"><code>for-effects</code></a>.

<pre class="lisp">     (all-values
       (let ((x (either 1 2 3 4)))
         (if (oddp x)
             x
             (fail)))) ; =&gt; (1 3)
</pre>
   <p>At first <code>(either 1 2 3 4)</code> evaluates to 1, which is <code>oddp</code>,
so <code>all-values</code> receives it and sets about producing the next
value. Now <code>either</code> returns 2, which isn't <code>oddp</code>. Hence
<code>fail</code> is called causing the system to backtrack.

   <p>Starting again from the choice-point 3 is produced, which is
<code>oddp</code>, and is received by <code>all-values</code>, which in turn
requests the next value. Now <code>either</code> returns 4, which again
causes <code>fail</code> to backtrack.

   <p>Since the only choice-point available cannot produce any more
alternatives, control passes back to <code>all-values</code> which returns
the collected values.

   <p>Had we wanted only one answer instead of an enumeration of all
possible answers we could have used <code>one-value</code> instead of
<code>all-values</code>.

   <p>If you're familiar with Prolog, <code>all-values</code> and <code>one-value</code>
are analogous to Prolog's <code>bagof</code> and <code>cut</code> primitives.

<h3 class="section">2.3 Generators</h3>

<p>Given <code>either</code> and <code>fail</code> we can write functions returning
arbitrary sequences of nondeterministic values. Such functions are
called <em>generators</em>, and by convention have names starting with
<code>a-</code> or <code>an-</code>.

   <p>Consider for example <code>an-integer-between</code>:

<pre class="lisp">     ;;; Screamer already provides an-integer-between, so we'll
     ;;; call this by a different name.
     (defun an-int-between (min max)
       (if (&gt; min max)
           (fail)
           (either min (an-int-between (1+ min) max))))
     
     (all-values (an-int-between 41 43)) ; =&gt; (41 42 43)
</pre>
   <p>Called with two integers, this function produces nondeterministic
values in the given range &ndash; finally backtracking to a previous
choice-point when all possibilities have been exhausted.

   <p>Given <code>an-integer-between</code> and <code>fail</code> we can write eg. a
generator for square numbers:

<pre class="lisp">     ;;; Square numbers are numbers produced by squaring an integer.
     (defun a-square-number (min max)
       (let* ((x (an-integer-between 0 max))
              (square (* x x)))
         (if (&lt;= min square max)
             square
             (fail))))
     
     (all-values (a-square-number 12 80)) ; =&gt; (16 25 36 49 64)
</pre>
   <p>We're not restricted to numbers, of course. Writing a generator for
potential comedy duos works just the same:

<pre class="lisp">     (defun a-comedic-actor ()
       (list (either :tall :short) (either :thin :fat)))
     
     (defun a-comedy-duo ()
       (let ((a (a-comedic-actor))
             (b (a-comedic-actor)))
         (if (or (eq (first a) (first b))
                 (eq (second a) (second b)))
             (fail)
             (list a :and b))))
     
     (one-value (a-comedy-duo)) ; =&gt; ((:TALL :THIN) :AND (:SHORT :FAT))
</pre>
   <h3 class="section">2.4 Side-Effects</h3>

<p>What should happen to side-effects when a nondeterministic function
backtracks? It depends. Some side-effects should be retained, and
some undone &ndash; and it is impossible for the system to know in
general what is the right choice in a given case.

   <p>Screamer is able to undo effects of <code>setf</code> and <code>setq</code>
(including calls to user-defined setf-functions), but cannot undo
calls to other functions with side-effects such as <code>set</code>,
<code>rplaca</code>, or <code>sort</code>.

   <p>By default all side-effects are retained:

<pre class="lisp">     (let ((n 0))
       (list :numbers
             (all-values (let ((x (an-integer-between 0 3)))
                           (incf n)
                           x))
             :n n)) ; =&gt; (:NUMBERS (0 1 2 3) :N 4)
</pre>
   <p>Macros <a href="#Macro-local"><code>local</code></a> and <a href="#Macro-global"><code>global</code></a> can be used to turn
undoing of side-effects on and off lexically.

<pre class="lisp">     (let ((m 0)
           (n 0))
       (list :numbers
             (all-values (let ((x (an-integer-between 0 3)))
                           (local
                             (incf n)
                             (global
                               (incf m)))
                           x))
             :m m
             :n n)) ; =&gt; (:NUMBERS (0 1 2 3) :M 4 :N 0)
</pre>
   <h3 class="section">2.5 Constraint Propagation</h3>

<p>In addition to nondeterminism via backtracking as discussed so far,
Screamer also provides for forward constraint propagation via
<em>logic variables</em> constructed using <a href="#Function-make_002dvariable"><code>make-variable</code></a>. 
Screamer provides a variety of primitives for constraining variables.

   <p>By convention suffix <code>v</code> is used to denote operators that accept
(and potentially return) variables in addition to values. Any
<code>foov</code> is generally just like <code>foo</code>, except its arguments
can also be logic variables, and that it may assert facts about them
and will possibly return another variable.

   <p>The operator <a href="#Macro-assert_0021"><code>assert!</code></a> is the primary tool about asserting facts
about variables.

   <p>Expression such as <code>(foov myvar)</code> typically returns another
variable depending on <code>myvar</code>, which can be constrained to be
true using <code>assert!</code>.

   <p>Operator <a href="#Function-bound_003f"><code>bound?</code></a> can be used to test if variable is bound to a
specific value, and <a href="#Function-value_002dof"><code>value-of</code></a> can be used to obtain its value.

<pre class="lisp">     ;;; Make a variable
     (defparameter *v* (make-variable "The Answer"))
     
     ;;; It is initially unconstrained.
     *v* ; =&gt; ["The Answer"]
     
     ;;; Constrain it to be an integer.
     (assert! (integerpv *v*))
     
     *v* ; =&gt; ["The Answer" integer]
     
     ;;; Constrain 40 to be 2 less than *v*
     (assert! (=v 40 (-v *v* 2)))
     
     ;;; And we have our answer.
     *v* ; =&gt; 42
     
     ;;; However, there's a catch. Even though *v* printed as 42 above, *v*
     ;;; is still a variable. This is convenience for working in the REPL:
     ;;; unbound variables print using square brackets, bound ones print
     ;;; as their value.
     (type-of *v*) ; =&gt; SCREAMER::VARIABLE
     
     ;;; To obtain its value:
     (value-of *v*) ; =&gt; 42
</pre>
   <p>Assertions &ndash; and constraint operators in general &ndash; can cause failure
and backtracking, in which case constraints from the last attempt are
undone.

   <p>This allows us to search the solution space using backtracking:

<pre class="lisp">     (defparameter *x* (make-variable "X"))
     (defparameter *y* (make-variable "Y"))
     
     (assert! (integerpv *x*))
     (assert! (integerpv *y*))
     
     (assert! (=v 0 (+v *x* *y* 42)))
     
     (all-values (let ((x (an-integer-between -50 -30))
                       (y (an-integer-between 2 5)))
                   (assert! (=v *x* x))
                   (assert! (=v *y* y))
                   (list x y))) ; =&gt; ((-47 5) (-46 4) (-45 3) (-44 2))
</pre>
   <p>A possibly less intuitive, but usually more efficient method is to
assert range constraints as variables instead of nondeterministic
values, and force a solution:

<pre class="lisp">     (assert! (=v *x* (an-integer-betweenv -50 -30)))
     (assert! (=v *y* (an-integer-betweenv 2 5)))
     
     (all-values
       (solution (list *x* *y*)
                 (static-ordering #'linear-force)))
     ; =&gt; ((-47 5) (-46 4) (-45 3) (-44 2))
</pre>
   <p>In this case backtracking occurs only inside <a href="#Function-solution"><code>solution</code></a>, when
the system is trying to apply different solution to the given
constraints, whereas in the first one we backtracked over the entire
<code>let</code>.

<h3 class="section">2.6 Current Limitations</h3>

<p>Screamer is implemented using a code-walker, which does not
unfortunately currently support the full ANSI Common Lisp.

<h4 class="subsection">2.6.1 Not Supported At All</h4>

<p>Following special operators signal an error if they appear in code processed
by the code walker:

     <ul>
<li>load-time-value
<li>symbol-macrolet
<li>macrolet

   </ul>

<h4 class="subsection">2.6.2 Limited Support</h4>

<p>Following special operators are accepted, but they cannot contain
nondeterministic forms:

     <ul>
<li>progv
<li>unwind-protect
<li>catch

   </ul>

   <p>Additionally, functions defined using <code>flet</code> and <code>labels</code>
are not in nondeterministic context, even if the surrounding context
is nondeterministic.

<h4 class="subsection">2.6.3 Limitations in Undoing Side-Effects</h4>

<p>Undoing side-effects via <code>local</code> is reliable only if the
<code>setf</code> and <code>setq</code> forms are lexically apparent:

<pre class="lisp">     (local (incf (foo)))
</pre>
   <p>may or may not work as expected, depending on how <code>foo</code> is
implemented. If <code>(incf (foo))</code> expands using eg. <code>set-foo</code>,
the code-walker will not notice the side-effect.

   <p>Undoing side-effects via <code>local</code> when there is no prior value
might not work as expected, depending on the implementation of the
place:

     <ul>
<li>If reading a non-existent value causes an error to be signalled, the
initial assignment inside <code>local</code> will cause that to happen.

     <p>Example: assignment to an unbound variable inside <code>local</code> signals
an error.

     <li>If reading a non-existent value causes a marker object (eg. 
<code>nil</code>) to be returned, undoing the side-effect means assigning
the marker object back to the place.

     <p>Example: undoing <code>(setf gethash)</code> of a previously unknown key
will cause <code>nil</code> to be stored in the table instead of removing
the new key and its value entirely via <code>remhash</code>.

   </ul>

<div class="node">
<a name="Examples"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Dictionary">Dictionary</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Overview">Overview</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h2 class="chapter">3 Examples</h2>

<h3 class="section">3.1 Einstein's Riddle</h3>

<p>Solving the &ldquo;Einstein's Riddle&rdquo; using nondeterministic features of
Screamer, ie. backtracking search.

   <p>[ <a href="http://nikodemus.github.com/screamer/einstein.lisp.html">HTML</a> ]
[ <a href="http://nikodemus.github.com/screamer/einstein.lisp">Source</a> ]

<h3 class="section">3.2 The Zebra Puzzle</h3>

<p>Solving the &ldquo;The Zebra Puzzle&rdquo;, using forward constraint propagation
features of Screamer.

   <p>(This puzzle is virtually identical to &ldquo;Einstein's Riddle&rdquo;, but the
solution is very different.)

   <p>[ <a href="http://nikodemus.github.com/screamer/zebra.lisp.html">HTML</a> ]
[ <a href="http://nikodemus.github.com/screamer/zebra.lisp">Source</a> ]

<h3 class="section">3.3 The Sudoku Puzzle</h3>

<p>Solving a sudoku puzzle using forward constraint propagation features
of Screamer.

   <p>[ <a href="http://nikodemus.github.com/screamer/sudoku.lisp.html">HTML</a> ]
[ <a href="http://nikodemus.github.com/screamer/sudoku.lisp">Source</a> ]

<div class="node">
<a name="Dictionary"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Function-Index">Function Index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Examples">Examples</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h2 class="chapter">4 Dictionary</h2>

<h3 class="section">4.1 Nondetermism</h3>

<p><a name="index-either-1"></a><a name="Macro-either"></a>

<div class="defun">
&mdash; Macro: <b>either</b><var> &amp;body alternatives<a name="index-either-2"></a></var><br>
<blockquote><p>Nondeterministically evaluates and returns the value of one of its
<code>alternatives</code>.

        <p><code>either</code> takes any number of arguments. With no arguments, <code>(either) </code>is
equivalent to <code>(fail) </code>and is thus deterministic. With one argument, (EITHER
X) is equivalent to <code>x</code> itself and is thus deterministic only when <code>x</code> is
deterministic. With two or more argument it is nondeterministic and can only
appear in a nondeterministic context.

        <p>It sets up a choice-point and evaluates the first <code>alternative</code> returning its
values. When backtracking follows to this choice-point, the next <code>alternative</code>
is evaluated and its values are returned. When no more <code>alternatives</code> remain,
the current choice-point is removed and backtracking continues to the next
most recent choice-point. 
</p></blockquote></div>

   <p><a name="index-fail-3"></a><a name="Function-fail"></a>

<div class="defun">
&mdash; Function: <b>fail</b><var><a name="index-fail-4"></a></var><br>
<blockquote><p>Backtracks to the most recent choice-point.

        <p><code>fail</code> is deterministic function and thus it is permissible to reference <code>#'fail</code>,
and write <code>(funcall #'fail) </code>or <code>(apply #'fail)</code>.

        <p>Calling <code>fail</code> when there is no choice-point to backtrack to signals an error. 
</p></blockquote></div>

   <p><a name="index-trail-5"></a><a name="Function-trail"></a>

<div class="defun">
&mdash; Function: <b>trail</b><var> function<a name="index-trail-6"></a></var><br>
<blockquote><p>When called in non-deterministic context, adds <code>function</code> to the trail. 
Outside non-deterministic context does nothing.

        <p>Functions on the trail are called when unwinding from a nondeterministic
selection (due to either a normal return, or calling <code>fail</code>.) 
</p></blockquote></div>

   <p><a name="index-all_002dvalues-7"></a><a name="Macro-all_002dvalues"></a>

<div class="defun">
&mdash; Macro: <b>all-values</b><var> &amp;body body<a name="index-all_002dvalues-8"></a></var><br>
<blockquote><p>Evaluates <code>body</code> as an implicit <code>progn</code> and returns a list of all of the
nondeterministic values yielded by the it.

        <p>These values are produced by repeatedly evaluating the body and backtracking
to produce the next value, until the body fails and yields no further values.

        <p>Accordingly, local side effects performed by the body while producing each
value are undone before attempting to produce subsequent values, and all local
side effects performed by the body are undone upon exit from <code>all-values</code>.

        <p>Returns a list containing <code>nil</code> if <code>body</code> is empty.

        <p>An <code>all-values</code> expression can appear in both deterministic and nondeterministic
contexts. Irrespective of what context the <code>all-values</code> appears in, the <code>body</code> is
always in a nondeterministic context. An <code>all-values</code> expression itself is
always deterministic.

        <p><code>all-values</code> is analogous to the `bagof' primitive in Prolog. 
</p></blockquote></div>

   <p><a name="index-one_002dvalue-9"></a><a name="Macro-one_002dvalue"></a>

<div class="defun">
&mdash; Macro: <b>one-value</b><var> form &amp;optional default<a name="index-one_002dvalue-10"></a></var><br>
<blockquote><p>Returns the first nondeterministic value yielded by <code>form</code>.

        <p>No further execution of <code>form</code> is attempted after it successfully returns one
value.

        <p>If <code>form</code> does not yield any nondeterministic values (i.e. it fails) then
<code>default</code> is evaluated and its value returned instead. <code>default</code> defaults to
<code>(fail) </code>if not present.

        <p>Local side effects performed by <code>form</code> are undone when <code>one-value</code> returns, but
local side effects performed by <code>default</code> are not undone when <code>one-value</code> returns.

        <p>A <code>one-value</code> expression can appear in both deterministic and nondeterministic
contexts. Irrespective of what context the <code>one-value</code> appears in, <code>form</code> is
always in a nondeterministic context, while <code>default</code> is in whatever context the
<code>one-value</code> form appears.

        <p>A <code>one-value</code> expression is nondeterministic if <code>default</code> is present and is
nondeterministic, otherwise it is deterministic.

        <p>If <code>default</code> is present and nondeterministic, and if <code>form</code> fails, then it is
possible to backtrack into the <code>default</code> and for the <code>one-value</code> form to
nondeterministically return multiple times. <code>one-value</code> is analogous to the cut
primitive (`!') in Prolog. 
</p></blockquote></div>

   <p><a name="index-for_002deffects-11"></a><a name="Macro-for_002deffects"></a>

<div class="defun">
&mdash; Macro: <b>for-effects</b><var> &amp;body body<a name="index-for_002deffects-12"></a></var><br>
<blockquote><p>Evaluates <code>body</code> as an implicit <code>progn</code> in a nondeterministic context and
returns <code>nil</code>.

        <p>The body is repeatedly backtracked to its first choice-point until the body
fails.

        <p>Local side effects performed by <code>body</code> are undone when <code>for-effects</code> returns.

        <p>A <code>for-effects</code> expression can appear in both deterministic and nondeterministic
contexts. Irrespective of what context the <code>for-effects</code> appears in, <code>body</code> are
always in a nondeterministic context. A <code>for-effects</code> expression is is always
deterministic. 
</p></blockquote></div>

   <p><a name="index-ith_002dvalue-13"></a><a name="Macro-ith_002dvalue"></a>

<div class="defun">
&mdash; Macro: <b>ith-value</b><var> i form &amp;optional default<a name="index-ith_002dvalue-14"></a></var><br>
<blockquote><p>Returns the Ith nondeterministic value yielded by <code>form</code>.

        <p>I must be an integer. The first nondeterministic value yielded by <code>form</code> is
numbered zero, the second one, etc. The Ith value is produced by repeatedly
evaluating <code>form</code>, backtracking through and discarding the first I values and
deterministically returning the next value produced.

        <p>No further execution of <code>form</code> is attempted after it successfully yields the
desired value.

        <p>If <code>form</code> fails before yielding both the I values to be discarded, as well as
the desired Ith value, then <code>default</code> is evaluated and its value returned
instead. <code>default</code> defaults to <code>(fail) </code>if not present.

        <p>Local side effects performed by <code>form</code> are undone when <code>ith-value</code> returns, but
local side effects performed by <code>default</code> and by I are not undone when <code>ith-value</code>
returns.

        <p>An <code>ith-value</code> expression can appear in both deterministic and nondeterministic
contexts. Irrespective of what context the <code>ith-value</code> appears in, <code>form</code> is
always in a nondeterministic context, while <code>default</code> and I are in whatever
context the <code>ith-value</code> appears in.

        <p>An <code>ith-value</code> expression is nondeterministic if <code>default</code> is present and is
nondeterministic, or if I is nondeterministic. Otherwise it is deterministic.

        <p>If <code>default</code> is present and nondeterministic, and if <code>form</code> fails, then it is
possible to backtrack into the <code>default</code> and for the <code>ith-value</code> expression to
nondeterministically return multiple times.

        <p>If I is nondeterministic then the <code>ith-value</code> expression operates
nondeterministically on each value of I. In this case, backtracking for each
value of <code>form</code> and <code>default</code> is nested in, and restarted for, each backtrack of
I. 
</p></blockquote></div>

   <p><a name="index-print_002dvalues-15"></a><a name="Macro-print_002dvalues"></a>

<div class="defun">
&mdash; Macro: <b>print-values</b><var> &amp;body body<a name="index-print_002dvalues-16"></a></var><br>
<blockquote><p>Evaluates <code>body</code> as an implicit <code>progn</code> and prints each of the nondeterministic
values yielded by it using <code>print</code>.

        <p>After each value is printed, the user is queried as to whether or not further
values are desired. These values are produced by repeatedly evaluating the
body and backtracking to produce the next value, until either the user
indicates that no further values are desired or until the body fails and
yields no further values.

        <p>Returns the last value printed.

        <p>Accordingly, local side effects performed by the body while producing each
value are undone after printing each value, before attempting to produce
subsequent values, and all local side effects performed by the body are undone
upon exit from <code>print-values</code>, either because there are no further values or
because the user declines to produce further values.

        <p>A <code>print-values</code> expression can appear in both deterministic and
nondeterministic contexts. Irrespective of what context the <code>print-values</code>
appears in, the <code>body</code> are always in a nondeterministic context. A
<code>print-values</code> expression itself is always deterministic.

        <p><code>print-values</code> is analogous to the standard top-level user interface in Prolog. 
</p></blockquote></div>

   <p><a name="index-possibly_003f-17"></a><a name="Macro-possibly_003f"></a>

<div class="defun">
&mdash; Macro: <b>possibly?</b><var> &amp;body body<a name="index-possibly_003f-18"></a></var><br>
<blockquote><p>Evaluates <code>body</code> as an implicit <code>progn</code> in nondeterministic context,
returning true if the body ever yields true.

        <p>The body is repeatedly backtracked as long as it yields <code>nil</code>. Returns
the first true value yielded by the body, or <code>nil</code> if body fails before
yielding true.

        <p>Local side effects performed by the body are undone when <code>possibly</code>? returns.

        <p>A <code>possibly</code>? expression can appear in both deterministic and nondeterministic
contexts. Irrespective of what context the <code>possibly</code>? appears in, its body is
always in a nondeterministic context. A <code>possibly</code>? expression is always
deterministic. 
</p></blockquote></div>

   <p><a name="index-necessarily_003f-19"></a><a name="Macro-necessarily_003f"></a>

<div class="defun">
&mdash; Macro: <b>necessarily?</b><var> &amp;body body<a name="index-necessarily_003f-20"></a></var><br>
<blockquote><p>Evaluates <code>body</code> as an implicit <code>progn</code> in nondeterministic context,
returning true if the body never yields false.

        <p>The body is repeatedly backtracked as long as it yields true. Returns the last
true value yielded by the body if it fails before yielding <code>nil</code>, otherwise
returns <code>nil</code>.

        <p>Local side effects performed by the body are undone when <code>necessarily</code>? returns.

        <p>A <code>necessarily</code>? expression can appear in both deterministic and
nondeterministic contexts. Irrespective of what context the <code>necessarily</code>? 
appears in, its body is always in a nondeterministic context. A <code>necessarily</code>? 
expression is always deterministic. 
</p></blockquote></div>

   <p><a name="index-global-21"></a><a name="Macro-global"></a>

<div class="defun">
&mdash; Macro: <b>global</b><var> &amp;body body<a name="index-global-22"></a></var><br>
<blockquote><p>Evaluates <code>body</code> in the same fashion as <code>progn</code> except that all <code>setf</code> and <code>setq</code>
forms lexically nested in its body result in global side effects which are not
undone upon backtracking.

        <p>Note that this affects only side effects introduced explicitly via <code>setf</code> and
<code>setq</code>. Side effects introduced by Common Lisp builtin functions such as <code>rplaca</code>
are always global anyway.

        <p><code>local</code> and <code>global</code> may be nested inside one another. The nearest lexically
surrounding one determines whether or not a given <code>setf</code> or <code>setq</code> results in a
local or global side effect.

        <p>Side effects default to be global when there is no surrounding <code>local</code> or <code>global</code>
expression. Global side effects can appear both in deterministic as well as
nondeterministic contexts. In nondeterministic contexts, <code>global</code> as well as
<code>setf</code> are treated as special forms rather than macros. This should be
completely transparent to the user. 
</p></blockquote></div>

   <p><a name="index-local-23"></a><a name="Macro-local"></a>

<div class="defun">
&mdash; Macro: <b>local</b><var> &amp;body body<a name="index-local-24"></a></var><br>
<blockquote><p>Evaluates <code>body</code> in the same fashion as <code>progn</code> except that all <code>setf</code> and <code>setq</code>
forms lexically nested in its body result in local side effects which are
undone upon backtracking.

        <p>This affects only side effects introduced explicitly via <code>setf</code> and <code>setq</code>. Side
effects introduced by either user defined functions or builtin Common Lisp
functions such as <code>rplaca</code> are always global.

        <p>Behaviour of side effects introduced by macro-expansions such as <code>incf</code> depends
on the exact macro-expansion. If <code>(incf (foo)) </code>expands using eg. <code>set-foo</code>, <code>local</code>
is unable to undo the side-effect.

        <p><code>local</code> cannot distinguish between initially uninitialized and intialized
places, such as unbound variables or hash-table keys with no prior values. As
a result, an attempt to assign an unbound variable inside <code>local</code> will signal an
error due to the system's attempt to first read the variable. Similarly,
undoing a <code>(setf gethash) </code>when the key did not previously exist in the table
will insert a <code>nil</code> into the table instead of doing a <code>remhash</code>. Easiest way
to work around this is by using <code>trail</code>.

        <p><code>local</code> and <code>global</code> may be nested inside one another. The nearest lexically
surrounding one determines whether or not a given <code>setf</code> or <code>setq</code> results in a
local or global side effect.

        <p>Side effects default to be global when there is no surrounding <code>local</code> or <code>global</code>
expression. Local side effects can appear both in deterministic as well as
nondeterministic contexts though different techniques are used to implement
the trailing of prior values for restoration upon backtracking. In
nondeterministic contexts, <code>local</code> as well as <code>setf</code> are treated as special forms
rather than macros. This should be completely transparent to the user. 
</p></blockquote></div>

   <p><a name="index-a_002dboolean-25"></a><a name="Function-a_002dboolean"></a>

<div class="defun">
&mdash; Function: <b>a-boolean</b><var><a name="index-a_002dboolean-26"></a></var><br>
<blockquote><p>Equivalent to <code>(either t nil)</code>. 
</p></blockquote></div>

   <p><a name="index-a_002dmember_002dof-27"></a><a name="Function-a_002dmember_002dof"></a>

<div class="defun">
&mdash; Function: <b>a-member-of</b><var> sequence<a name="index-a_002dmember_002dof-28"></a></var><br>
<blockquote><p>Nondeterministically returns an element of <code>sequence</code>. The elements are
returned in the order that they appear in <code>sequence</code>. The <code>sequence</code> must be
either a list or a vector. 
</p></blockquote></div>

   <p><a name="index-an_002dinteger-29"></a><a name="Function-an_002dinteger"></a>

<div class="defun">
&mdash; Function: <b>an-integer</b><var><a name="index-an_002dinteger-30"></a></var><br>
<blockquote><p>Generator yielding integers in sequence 0, 1, -1, 2, -2, ... 
</p></blockquote></div>

   <p><a name="index-an_002dinteger_002dabove-31"></a><a name="Function-an_002dinteger_002dabove"></a>

<div class="defun">
&mdash; Function: <b>an-integer-above</b><var> low<a name="index-an_002dinteger_002dabove-32"></a></var><br>
<blockquote><p>Generator yielding integers starting from <code>low</code> and continuing sequentially
in increasing direction. 
</p></blockquote></div>

   <p><a name="index-an_002dinteger_002dbelow-33"></a><a name="Function-an_002dinteger_002dbelow"></a>

<div class="defun">
&mdash; Function: <b>an-integer-below</b><var> high<a name="index-an_002dinteger_002dbelow-34"></a></var><br>
<blockquote><p>Generator yielding integers starting from <code>high</code> and continuing sequentially
in decreasing direction. 
</p></blockquote></div>

   <p><a name="index-an_002dinteger_002dbetween-35"></a><a name="Function-an_002dinteger_002dbetween"></a>

<div class="defun">
&mdash; Function: <b>an-integer-between</b><var> low high<a name="index-an_002dinteger_002dbetween-36"></a></var><br>
<blockquote><p>Nondeterministically returns an integer in the closed interval [<code>low</code>, <code>high</code>]. 
The results are returned in ascending order. Both <code>low</code> and <code>high</code> must be
integers. Fails if the interval does not contain any integers. 
</p></blockquote></div>

   <p><a name="index-apply_002dnondeterministic-37"></a><a name="Function-apply_002dnondeterministic"></a>

<div class="defun">
&mdash; Function: <b>apply-nondeterministic</b><var> function &amp;rest arguments<a name="index-apply_002dnondeterministic-38"></a></var><br>
<blockquote><p>Analogous to the <code>cl:apply</code>, except <code>function</code> can be either a nondeterministic
function, or an ordinary deterministic function.

        <p>You must use <code>apply-nondeterministic</code> to apply a nondeterministic function. An
error is signalled if a nondeterministic function object is used with
<code>cl:apply</code>.

        <p>You can use <code>apply-nondeterministic</code> to apply either a deterministic or
nondeterministic function, though even if all of the <code>arguments</code> are
deterministic and <code>function</code> is a deterministic function object, the call
expression will still be nondeterministic (with presumably a single value),
since it is impossible to determine at compile time that a given call to
<code>apply-nondeterministic</code> will be passed only deterministic function objects for
function. 
</p></blockquote></div>

   <p><a name="index-funcall_002dnondeterministic-39"></a><a name="Function-funcall_002dnondeterministic"></a>

<div class="defun">
&mdash; Function: <b>funcall-nondeterministic</b><var> function &amp;rest arguments<a name="index-funcall_002dnondeterministic-40"></a></var><br>
<blockquote><p>Analogous to <code>cl:funcall</code>, except <code>function</code> can be either a nondeterministic
function, or an ordinary determinisitic function.

        <p>You must use <code>funcall-nondeterministic</code> to funcall a nondeterministic function. 
An error is signalled if you attempt to funcall a nondeterministic
function object with <code>cl:funcall</code>.

        <p>You can use <code>funcall-nondeterministic</code> to funcall either a deterministic or
nondeterministic function, though even if all of the <code>arguments</code> are
deterministic and <code>function</code> is a deterministic function object, the call
expression will still be nondeterministic (with presumably a single value),
since it is impossible to determine at compile time that a given call to
<code>funcall-nondeterministic</code> will be passed only deterministic function objects
for function. 
</p></blockquote></div>

   <p><a name="index-multiple_002dvalue_002dcall_002dnondeterministic-41"></a><a name="Function-multiple_002dvalue_002dcall_002dnondeterministic"></a>

<div class="defun">
&mdash; Function: <b>multiple-value-call-nondeterministic</b><var> function-form &amp;rest values-forms<a name="index-multiple_002dvalue_002dcall_002dnondeterministic-42"></a></var><br>
<blockquote><p>Analogous to the <code>cl:multiple-value-call</code>, except <code>function-form</code> can evaluate
to either a nondeterministic function, or an ordinary deterministic function.

        <p>You must use <code>multiple-value-call-nondeterministic</code> to multiple-value-call a
nondeterministic function. An error is signalled if a nondeterministic function
object is used with <code>cl:multiple-value-call</code>.

        <p>You can use <code>multiple-value-call-nondeterministic</code> to call either a
deterministic or nondeterministic function, though even if all of the
<code>values-forms</code> are deterministic and <code>function-form</code> evaluates to a deterministic
function object, the call expression will still be nondeterministic (with
presumably a single value), since it is impossible to determine at compile
time that a given call to <code>multiple-value-call-nondeterministic</code> will be passed
only deterministic function objects for function.

        <p>While <code>multiple-value-call-nondeterministic</code> appears to be a function, it
is really a special-operator implemented by the code-walkers processing
nondeterministic source contexts. 
</p></blockquote></div>

   <p><a name="index-nondeterministic_002dfunction_003f-43"></a><a name="Function-nondeterministic_002dfunction_003f"></a>

<div class="defun">
&mdash; Function: <b>nondeterministic-function?</b><var> x<a name="index-nondeterministic_002dfunction_003f-44"></a></var><br>
<blockquote><p>Returns <code>t</code> if <code>x</code> is a nondeterministic function and <code>nil</code> otherwise.

        <p><code>#'foo</code> returns a nondeterministic function object iff it is used in nondeterminisitc
context and <code>foo</code> is either a nondeterministic <code>lambda</code> form, or the name of a
nondeterministic function defined using <code>screamer::defun</code>.

        <p>Currently, if <code>foo</code> is a nondeterministic function defined using
<code>screamer::defun</code>, <code>#'foo</code> and <code>(symbol-function 'foo) </code>in deterministic context
will return an ordinary deterministic Common Lisp function, which will signal
an error at runtime. 
</p></blockquote></div>

   <p><a name="index-when_002dfailing-45"></a><a name="Macro-when_002dfailing"></a>

<div class="defun">
&mdash; Macro: <b>when-failing</b> (<var>&amp;body failing-forms</var>)<var> &amp;body body<a name="index-when_002dfailing-46"></a></var><br>
<blockquote><p>Whenever <code>fail</code> is called during execution of <code>body</code>, executes <code>failing-forms</code>
before unwinding. 
</p></blockquote></div>

   <p><a name="index-count_002dfailures-47"></a><a name="Macro-count_002dfailures"></a>

<div class="defun">
&mdash; Macro: <b>count-failures</b><var> &amp;body body<a name="index-count_002dfailures-48"></a></var><br>
<blockquote><p>Executes <code>body</code> keeping track of the number of times <code>fail</code> has been called
without unwinding from <code>body</code>. After <code>body</code> completes, reports the number of
failures to <code>*standard-output*</code> before returning values from <code>body</code>. 
</p></blockquote></div>

<h3 class="section">4.2 Constraints</h3>

<h4 class="subsection">4.2.1 Basics</h4>

<p><a name="index-make_002dvariable-49"></a><a name="Function-make_002dvariable"></a>

<div class="defun">
&mdash; Function: <b>make-variable</b><var> &amp;optional name<a name="index-make_002dvariable-50"></a></var><br>
<blockquote><p>Creates and returns a new variable. Variables are assigned a name
which is only used to identify the variable when it is printed. If the
parameter <code>name</code> is given then it is assigned as the name of the
variable. Otherwise, a unique name is assigned. The parameter <code>name</code> can
be any Lisp object. 
</p></blockquote></div>

   <p><a name="index-assert_0021-51"></a><a name="Macro-assert_0021"></a>

<div class="defun">
&mdash; Macro: <b>assert!</b><var> x<a name="index-assert_0021-52"></a></var><br>
<blockquote><p>Restricts <code>x</code> to <code>t</code>. No meaningful result is returned. The argument <code>x</code> can be
either a variable or a non-variable.

        <p>This assertion may cause other assertions to be made due to noticers attached
to <code>x</code>.

        <p>A call to <code>assert</code>! fails if <code>x</code> is known not to equal <code>t</code> prior to the assertion or
if any of the assertions performed by the noticers result in failure.

        <p>Except for the fact that one cannot write <code>#'assert</code>!, <code>assert</code>! behaves like a
function, even though it is implemented as a macro.

        <p>The reason it is implemented as a macro is to allow a number of compile time
optimizations. Expressions like <code>(assert! (notv x))</code>, <code>(assert! (numberpv x))</code>
and <code>(assert! (notv (numberv x))) </code>are transformed into calls to functions
internal to Screamer which eliminate the need to create the boolean
variable(s) normally returned by functions like <code>notv</code> and <code>numberpv</code>. Calls to
the functions <code>numberpv</code>, <code>realpv</code>, <code>integerpv</code>, <code>memberv</code>, <code>booleanpv</code>, <code>=v</code>, <code>&lt;v</code>, <code>&lt;=v</code>,
<code>&gt;v</code>, <code>&gt;=v</code>, <code>/=v</code>, <code>notv</code>, <code>funcallv</code>, <code>applyv</code> and <code>equalv</code> which appear directly nested
in a call to <code>assert</code>!, or directly nested in a call to <code>notv</code> which is in turn
directly nested in a call to <code>assert</code>!, are similarly transformed. 
</p></blockquote></div>

   <p><a name="index-value_002dof-53"></a><a name="Function-value_002dof"></a>

<div class="defun">
&mdash; Function: <b>value-of</b><var> x<a name="index-value_002dof-54"></a></var><br>
<blockquote><p>Returns <code>x</code> if <code>x</code> is not a variable. If <code>x</code> is a variable then <code>value-of</code>
dereferences <code>x</code> and returns the dereferenced value. If <code>x</code> is bound then
the value returned will not be a variable. If <code>x</code> is unbound then the
value returned will be a variable which may be <code>x</code> itself or another
variable which is shared with <code>x</code>. 
</p></blockquote></div>

   <p><a name="index-apply_002dsubstitution-55"></a><a name="Function-apply_002dsubstitution"></a>

<div class="defun">
&mdash; Function: <b>apply-substitution</b><var> x<a name="index-apply_002dsubstitution-56"></a></var><br>
<blockquote><p>If <code>x</code> is a <code>cons</code>, or a variable whose value is a <code>cons</code>, returns
a freshly consed copy of the tree with all variables dereferenced. 
Otherwise returns the value of <code>x</code>. 
</p></blockquote></div>

   <p><a name="index-bound_003f-57"></a><a name="Function-bound_003f"></a>

<div class="defun">
&mdash; Function: <b>bound?</b><var> x<a name="index-bound_003f-58"></a></var><br>
<blockquote><p>Returns <code>t</code> if <code>x</code> is not a variable or if <code>x</code> is a bound variable. Otherwise
returns <code>nil</code>. <code>bound</code>? is analogous to the extra-logical predicates `var' and
`nonvar' typically available in Prolog. 
</p></blockquote></div>

   <p><a name="index-ground_003f-59"></a><a name="Function-ground_003f"></a>

<div class="defun">
&mdash; Function: <b>ground?</b><var> x<a name="index-ground_003f-60"></a></var><br>
<blockquote><p>The primitive <code>ground</code>? is an extension of the primitive <code>bound</code>? which
can recursively determine whether an entire aggregate object is
bound. Returns <code>t</code> if <code>x</code> is bound and either the value of <code>x</code> is atomic or
a <code>cons</code> tree where all atoms are bound.

        <p>Otherwise returns nil. 
</p></blockquote></div>

   <p><a name="index-applyv-61"></a><a name="Function-applyv"></a>

<div class="defun">
&mdash; Function: <b>applyv</b><var> f x &amp;rest xs<a name="index-applyv-62"></a></var><br>
<blockquote><p><code>f</code> must be a deterministic function. If all arguments <code>x</code> are bound, returns
the result of calling <code>f</code> on the dereferenced values of spread arguments.

        <p>Otherwise returns a fresh variable <code>v</code>, constrained to be equal to the result
of calling <code>f</code> on the dereferenced values of arguments.

        <p>Additionally, if all but one of <code>v</code> and the argument variables become known, and
the remaining variable has a finite domain, then that domain is further
restricted to be consistent with other arguments. 
</p></blockquote></div>

   <p><a name="index-funcallv-63"></a><a name="Function-funcallv"></a>

<div class="defun">
&mdash; Function: <b>funcallv</b><var> f &amp;rest x<a name="index-funcallv-64"></a></var><br>
<blockquote><p><code>f</code> must be a deterministic function. If all arguments <code>x</code> are bound, returns
the result of calling <code>f</code> on the dereferenced values of arguments.

        <p>Otherwise returns a fresh variable <code>v</code>, constrained to be equal to the result
of calling <code>f</code> on the dereferenced values of arguments.

        <p>Additionally, if all but one of <code>v</code> and the argument variables become known, and
the remaining variable has a finite domain, then that domain is further
restricted to be consistent with other arguments. 
</p></blockquote></div>

   <p><a name="index-equalv-65"></a><a name="Function-equalv"></a>

<div class="defun">
&mdash; Function: <b>equalv</b><var> x y<a name="index-equalv-66"></a></var><br>
<blockquote><p>Returns <code>t</code> if the aggregate object <code>x</code> is known to equal the aggregate object
<code>y</code>, <code>nil</code> if the aggregate object <code>x</code> is known not to equal the aggregate object <code>y</code>,
and a new boolean variable <code>v</code> if it is not known whether or not <code>x</code> equals <code>y</code> when
<code>equalv</code> is called.

        <p>The values of <code>x</code>, <code>y</code> and <code>v</code> are mutually constraints via noticers so that <code>v</code>
equals <code>t</code> if and only if <code>x</code> is known to equal <code>y</code> and <code>v</code> equals <code>nil</code> if and only if
<code>x</code> is known not to equal <code>y</code>.

        <p>Noticers are attached to <code>v</code> as well as to all variables nested in both in <code>x</code> and
<code>y</code>. When the noticers attached to variables nested in <code>x</code> and <code>y</code> detect that <code>x</code> is
known to equal <code>y</code> they restrict <code>v</code> to equal <code>t</code>. Likewise, when the noticers
attached to variables nested in <code>x</code> and <code>y</code> detect that <code>x</code> is known not to equal <code>y</code>
they restrict <code>v</code> to equal <code>nil</code>.

        <p>Furthermore, if <code>v</code> later becomes known to equal <code>t</code> then <code>x</code> and <code>y</code> are unified. 
Likewise, if <code>v</code> later becomes known to equal <code>nil</code> then <code>x</code> and <code>y</code> are restricted to
not be equal. This is accomplished by attaching noticers to the variables
nested in <code>x</code> and <code>y</code> which detect when <code>x</code> becomes equal to <code>y</code> and fail.

        <p>The expression <code>(known? (equalv x y)) </code>is analogous to the extra-logical predicate
`==' typically available in Prolog.

        <p>The expression <code>(known? (notv (equalv x y))) </code>is analogous to the extra-logical
predicate `\=' typically available in Prolog.

        <p>The expression <code>(assert! (equalv x y)) </code>is analogous to Prolog unification.

        <p>The expression <code>(assert! (notv (equalv x y))) </code>is analogous to the
disunification operator available in Prolog-II. 
</p></blockquote></div>

   <p><a name="index-template-67"></a><a name="Function-template"></a>

<div class="defun">
&mdash; Function: <b>template</b><var> template<a name="index-template-68"></a></var><br>
<blockquote><p>Copies an aggregate object, replacing any symbol beginning with a question
mark with a newly created variable.

        <p>If the same symbol appears more than once in <code>x</code>, only one variable is created
for that symbol, the same variable replacing any occurrences of that symbol. 
Thus <code>(template '(a b (?c d ?e) ?e)) </code>has the same effect as:

     <pre class="lisp">            (LET ((?C (MAKE-VARIABLE))
                  (?E (MAKE-VARIABLE)))
              (LIST 'A 'B (LIST C 'D E) E)).
</pre>
        <p>This is useful for creating patterns to be unified with other structures. 
</p></blockquote></div>

<h4 class="subsection">4.2.2 Booleans</h4>

<p><a name="index-a_002dbooleanv-69"></a><a name="Function-a_002dbooleanv"></a>

<div class="defun">
&mdash; Function: <b>a-booleanv</b><var> &amp;optional name<a name="index-a_002dbooleanv-70"></a></var><br>
<blockquote><p>Returns a boolean variable. 
</p></blockquote></div>

   <p><a name="index-booleanpv-71"></a><a name="Function-booleanpv"></a>

<div class="defun">
&mdash; Function: <b>booleanpv</b><var> x<a name="index-booleanpv-72"></a></var><br>
<blockquote><p>The expression <code>(booleanpv x) </code>is an abbreviation for <code>(memberv x '(t nil))</code>. 
</p></blockquote></div>

   <p><a name="index-known_003f-73"></a><a name="Macro-known_003f"></a>

<div class="defun">
&mdash; Macro: <b>known?</b><var> x<a name="index-known_003f-74"></a></var><br>
<blockquote><p>Restricts <code>x</code> to be a boolean. If <code>x</code> is equal to <code>t</code> after being restricted to
be boolean, returns <code>t</code>. If <code>x</code> is equal to <code>nil</code> or if the value of <code>x</code> is unknown
returns <code>nil</code>. The argument <code>x</code> can be either a variable or a non-variable.

        <p>The initial restriction to boolean may cause other assertions to be made due
to noticers attached to <code>x</code>. A call to <code>known</code>? fails if <code>x</code> is known not to be
boolean prior to the assertion or if any of the assertions performed by the
noticers result in failure.

        <p>Restricting <code>x</code> to be boolean attaches a noticer on <code>x</code> so that any subsequent
assertion which restricts <code>x</code> to be non-boolean will fail.

        <p>Except for the fact that one cannot write <code>#'known</code>?, <code>known</code>? behaves like a
function, even though it is implemented as a macro.

        <p>The reason it is implemented as a macro is to allow a number of compile time
optimizations. Expressions like <code>(known? (notv x))</code>, <code>(known? (numberpv x))</code>
and <code>(known? (notv (numberpv x))) </code>are transformed into calls to functions
internal to Screamer which eliminate the need to create the boolean
variable(s) normally returned by functions like <code>notv</code> and <code>numberv</code>. Calls to
the functions <code>numberpv</code>, <code>realpv</code>, <code>integerpv</code>, <code>memberv</code>, <code>booleanpv</code>, <code>=v</code>, <code>&lt;v</code>, <code>&lt;=v</code>, <code>v</code>,
&gt;=v, /=v, <code>notv</code>, <code>funcallv</code>, <code>applyv</code> and <code>equalv</code> which appear directly nested in a
call to <code>known</code>?, or directly nested in a call to <code>notv</code> which is in turn directly
nested in a call to <code>known</code>?, are similarly transformed. 
</p></blockquote></div>

   <p><a name="index-decide-75"></a><a name="Macro-decide"></a>

<div class="defun">
&mdash; Macro: <b>decide</b><var> x<a name="index-decide-76"></a></var><br>
<blockquote><p>Restricts <code>x</code> to a be boolean. After <code>x</code> is restricted a nondeterministic
choice is made. For one branch, <code>x</code> is restricted to equal <code>t</code> and <code>(decide x)</code>
returns <code>t</code> as a result. For the other branch, <code>x</code> is restricted to equal <code>nil</code> and
<code>(decide x) </code>returns <code>nil</code> as a result. The argument <code>x</code> can be either a variable
or a non-variable.

        <p>The initial restriction to boolean may cause other assertions to be made due
to noticers attached to <code>x</code>. A call to <code>decide</code> immediately fails if <code>x</code> is known
not to be boolean prior to the assertion or if any of the assertions performed
by the noticers result in failure.

        <p>Restricting <code>x</code> to be boolean attaches a noticer on <code>x</code> so that any subsequent
assertion which restricts <code>x</code> to be non-boolean will fail.

        <p>Except for implementation optimizations <code>(decide x) </code>is equivalent to:

     <pre class="lisp">            (EITHER (PROGN (ASSERT! X) T) (PROGN (ASSERT! (NOTV X)) NIL))
</pre>
        <p>Except for the fact that one cannot write <code>#'decide</code>, <code>decide</code> behaves like a
function, even though it is implemented as a macro.

        <p>The reason it is implemented as a macro is to allow a number of compile time
optimizations. Expressions like <code>(decide (notv x))</code>, <code>(decide (numberpv x))</code>
and <code>(decide (notv (numberpv x))) </code>are transformed into calls to functions
internal to Screamer which eliminate the need to create the boolean
variable(s) normally returned by functions like notv and numberv. Calls to
the functions <code>numberpv</code>, <code>realpv</code>, <code>integerpv</code>, <code>memberpv</code>, <code>booleanpv</code>, <code>=v</code>, <code>&lt;v</code>, <code>&lt;=v</code>,
<code>&gt;v</code>, <code>&gt;=v</code>, <code>/=v</code>, <code>notv</code>, <code>funcallv</code>, <code>applyv</code> and <code>equalv</code> which appear directly nested
in a call to decide, or directly nested in a call to <code>notv</code> which is in turn
directly nested in a call to decide, are similarly transformed. 
</p></blockquote></div>

   <p><a name="index-notv-77"></a><a name="Function-notv"></a>

<div class="defun">
&mdash; Function: <b>notv</b><var> x<a name="index-notv-78"></a></var><br>
<blockquote><p>Restricts <code>x</code> to be a boolean.

        <p>Returns <code>t</code> if this restricts <code>x</code> to <code>nil</code>, and <code>t</code> if this restricts <code>x</code> to <code>nil</code>.

        <p>Otherwise returns a new boolean variable <code>v</code>. <code>v</code> and <code>x</code> are mutually constrained
via noticers, so that if either is later known to equal <code>t</code>, the other is
restricted to equal <code>nil</code> and vice versa.

        <p>Note that unlike <code>cl:not</code> <code>notv</code> does not accept arbitrary values as arguments: it
fails if its argument is not <code>t</code>, <code>nil</code>, or variable that can be restricted to a
boolean. 
</p></blockquote></div>

   <p><a name="index-andv-79"></a><a name="Function-andv"></a>

<div class="defun">
&mdash; Function: <b>andv</b><var> &amp;rest xs<a name="index-andv-80"></a></var><br>
<blockquote><p>Restricts each argument to be boolean.

        <p>Returns <code>t</code> if called with no arguments, or if all arguments are known to equal
<code>t</code> after being restricted to be boolean, and returns <code>nil</code> if any argument is
known to equal <code>nil</code> after this restriction.

        <p>Otherwise returns a boolean variable <code>v</code>. The values of the arguments and <code>v</code> are
mutually constrained:

          <ul>
<li>If any argument is later known to equal <code>nil</code> value of <code>v</code> becomes <code>nil</code>.

          <li>If all arguments are later known to equal <code>t</code>, value of <code>v</code> becomes <code>t</code>.

          <li>If value of <code>v</code> is later known to equal <code>t</code>, all arguments become <code>t</code>.

          <li>If value of <code>v</code> is later known to equal <code>nil</code>, and all but one argument is
   known to be <code>t</code>, the remaining argument becomes <code>nil</code>.

        </ul>
        Note that unlike <code>cl:and</code>, <code>andv</code> is a function and always evaluates all its
arguments. Secondly, any non-boolean argument causes it to fail. 
</p></blockquote></div>

   <p><a name="index-orv-81"></a><a name="Function-orv"></a>

<div class="defun">
&mdash; Function: <b>orv</b><var> &amp;rest xs<a name="index-orv-82"></a></var><br>
<blockquote><p>Restricts each argument to be boolean.

        <p>Returns <code>nil</code> if called with no arguments, or if all arguments are known to
equal <code>nil</code> after being restructed to be boolean, and returns <code>t</code> if any argument
is known to equal <code>t</code> after this restriction.

        <p>Otherwise returns a boolean variable <code>v</code>. The values of arguments and <code>v</code> are
mutually constrained:

          <ul>
<li>If any argument is later known to equal <code>t</code>, value of <code>v</code> becomes <code>t</code>.

          <li>If all arguments are later known to equal <code>nil</code>, value of <code>v</code> becomes <code>nil</code>.

          <li>If value of <code>v</code> is later known to equal <code>nil</code>, all arguments become <code>nil</code>.

          <li>If value of <code>v</code> is later known to equal <code>t</code>, and all but one argument is
   known to be <code>nil</code>, the remaining argument becomes <code>t</code>.

        </ul>
        Note that unlike <code>cl:or</code>, <code>orv</code> is a function and always evaluates all its
arguments. Secondly, any non-boolean argument causes it to fail. 
</p></blockquote></div>

   <p><a name="index-count_002dtruesv-83"></a><a name="Function-count_002dtruesv"></a>

<div class="defun">
&mdash; Function: <b>count-truesv</b><var> &amp;rest xs<a name="index-count_002dtruesv-84"></a></var><br>
<blockquote><p>Constrains all its arguments to be boolean. If each argument is known, returns
the number of <code>t</code> arguments. Otherwise returns a fresh constraint variable <code>v</code>.

        <p><code>v</code> and arguments are mutually constrained:

          <ul>
<li>Lower bound of <code>v</code> is the number arguments known to be <code>t</code>.

          <li>Upper bound of <code>v</code> is the number arguments minus the number of arguments known to be <code>nil</code>.

          <li>If lower bound of <code>v</code> is constrained to be equal to number of arguments known
   to be <code>nil</code>, all arguments not known to be <code>nil</code> are constrained to be <code>t</code>.

          <li>If Upper bound of <code>v</code> is constrained to be equal to number of arguments known
   to be <code>t</code>, all arguments not known to be <code>t</code> are constrained to be <code>nil</code>. 
</ul>
        </p></blockquote></div>

<h4 class="subsection">4.2.3 Sequences</h4>

<p><a name="index-a_002dmember_002dofv-85"></a><a name="Function-a_002dmember_002dofv"></a>

<div class="defun">
&mdash; Function: <b>a-member-ofv</b><var> values &amp;optional name<a name="index-a_002dmember_002dofv-86"></a></var><br>
<blockquote><p>Returns a variable whose value is constrained to be one of <code>values</code>. 
<code>values</code> can be either a vector or a list designator. 
</p></blockquote></div>

   <p><a name="index-memberv-87"></a><a name="Function-memberv"></a>

<div class="defun">
&mdash; Function: <b>memberv</b><var> x sequence<a name="index-memberv-88"></a></var><br>
<blockquote><p>Returns <code>t</code> if <code>x</code> is known to be a member of <code>sequence</code> (using the Common Lisp
function <code>eql</code> as a test function), <code>nil</code> if <code>x</code> is known not to be a member of
<code>sequence</code>, and otherwise returns a new boolean variable <code>v</code>.

        <p>When a new variable is created, the values of <code>x</code> and <code>v</code> are mutually constrained
via noticers so that <code>v</code> is equal to <code>t</code> if and only if <code>x</code> is known to be a member
of <code>sequence</code> and <code>v</code> is equal to <code>nil</code> if and only if <code>x</code> is known not to be a member
of <code>sequence</code>.

          <ul>
<li>If <code>x</code> later becomes known to be a member of <code>sequence</code>, a noticer attached to <code>x</code>
  restricts v to equal <code>t</code>. Likewise, if <code>x</code> later becomes known not to be a
  member of <code>sequence</code>, a noticer attached to <code>x</code> restricts <code>v</code> to equal <code>nil</code>.

          <li>If <code>v</code> ever becomes known to equal <code>t</code> then a noticer attached to <code>v</code> restricts <code>x</code>
  to be a member of <code>sequence</code>. Likewise, if <code>v</code> ever becomes known to equal <code>nil</code>
  then a noticer attached to <code>v</code> restricts <code>x</code> not to be a member of <code>sequence</code>.

        </ul>
        The current implementation imposes two constraints on the parameter <code>sequence</code>. 
First, <code>sequence</code> must be bound when <code>memberv</code> is called. Second, <code>sequence</code> must
not contain any unbound variables when <code>memberv</code> is called.

        <p>The value of parameter <code>sequence</code> must be a sequence, i.e. either a list or a
vector. 
</p></blockquote></div>

<h4 class="subsection">4.2.4 Numbers</h4>

<p><a name="index-a_002dnumberv-89"></a><a name="Function-a_002dnumberv"></a>

<div class="defun">
&mdash; Function: <b>a-numberv</b><var> &amp;optional name<a name="index-a_002dnumberv-90"></a></var><br>
<blockquote><p>Returns a variable whose value is constained to be a number. 
</p></blockquote></div>

   <p><a name="index-a_002drealv-91"></a><a name="Function-a_002drealv"></a>

<div class="defun">
&mdash; Function: <b>a-realv</b><var> &amp;optional name<a name="index-a_002drealv-92"></a></var><br>
<blockquote><p>Returns a real variable. 
</p></blockquote></div>

   <p><a name="index-a_002dreal_002dabovev-93"></a><a name="Function-a_002dreal_002dabovev"></a>

<div class="defun">
&mdash; Function: <b>a-real-abovev</b><var> low &amp;optional name<a name="index-a_002dreal_002dabovev-94"></a></var><br>
<blockquote><p>Returns a real variable whose value is constrained to be greater than or equal to <code>low</code>. 
</p></blockquote></div>

   <p><a name="index-a_002dreal_002dbelowv-95"></a><a name="Function-a_002dreal_002dbelowv"></a>

<div class="defun">
&mdash; Function: <b>a-real-belowv</b><var> high &amp;optional name<a name="index-a_002dreal_002dbelowv-96"></a></var><br>
<blockquote><p>Returns a real variable whose value is constrained to be less than or equal to <code>high</code>. 
</p></blockquote></div>

   <p><a name="index-a_002dreal_002dbetweenv-97"></a><a name="Function-a_002dreal_002dbetweenv"></a>

<div class="defun">
&mdash; Function: <b>a-real-betweenv</b><var> low high &amp;optional name<a name="index-a_002dreal_002dbetweenv-98"></a></var><br>
<blockquote><p>Returns a real variable whose value is constrained to be greater than or
equal to low and less than or equal to high. If the resulting real variable is
bound, its value is returned instead. Fails if it is known that low is greater
than high at the time of call.

        <p>The expression <code>(a-real-betweenv low high) </code>is an abbreviation for:

     <pre class="lisp">           (LET ((V (MAKE-VARIABLE)))
              (ASSERT! (REALPV V))
              (ASSERT! (&gt;=V V LOW))
              (ASSERT! (&lt;=V V HIGH))
              (VALUE-OF V))
</pre>
        </blockquote></div>

   <p><a name="index-an_002dintegerv-99"></a><a name="Function-an_002dintegerv"></a>

<div class="defun">
&mdash; Function: <b>an-integerv</b><var> &amp;optional name<a name="index-an_002dintegerv-100"></a></var><br>
<blockquote><p>Returns an integer variable. 
</p></blockquote></div>

   <p><a name="index-an_002dinteger_002dabovev-101"></a><a name="Function-an_002dinteger_002dabovev"></a>

<div class="defun">
&mdash; Function: <b>an-integer-abovev</b><var> low &amp;optional name<a name="index-an_002dinteger_002dabovev-102"></a></var><br>
<blockquote><p>Returns an integer variable whose value is constrained to be greater than
or equal to <code>low</code>. 
</p></blockquote></div>

   <p><a name="index-an_002dinteger_002dbelowv-103"></a><a name="Function-an_002dinteger_002dbelowv"></a>

<div class="defun">
&mdash; Function: <b>an-integer-belowv</b><var> high &amp;optional name<a name="index-an_002dinteger_002dbelowv-104"></a></var><br>
<blockquote><p>Returns an integer variable whose value is constrained to be less than or
equal to <code>high</code>. 
</p></blockquote></div>

   <p><a name="index-an_002dinteger_002dbetweenv-105"></a><a name="Function-an_002dinteger_002dbetweenv"></a>

<div class="defun">
&mdash; Function: <b>an-integer-betweenv</b><var> low high &amp;optional name<a name="index-an_002dinteger_002dbetweenv-106"></a></var><br>
<blockquote><p>Returns an integer variable whose value is constrained to be greater than
or equal to <code>low</code> and less than or equal to <code>high</code>. If the resulting integer
variable is bound, its value is returned instead. Fails if it is known that
there is no integer between <code>low</code> and <code>high</code> at the time of call.

        <p>The expression <code>(an-integer-betweenv low high) </code>is an abbreviation for:

     <pre class="lisp">           (LET ((V (MAKE-VARIABLE)))
              (ASSERT! (INTEGERPV V))
              (ASSERT! (&gt;=V V LOW))
              (ASSERT! (&lt;=V V HIGH))
              (VALUE-OF v))
</pre>
        </blockquote></div>

   <p><a name="index-numberpv-107"></a><a name="Function-numberpv"></a>

<div class="defun">
&mdash; Function: <b>numberpv</b><var> x<a name="index-numberpv-108"></a></var><br>
<blockquote><p>Returns <code>t</code> if <code>x</code> is known to be numeric, <code>nil</code> if <code>x</code> is known to be
non-numeric, and otherwise returns a new boolean variable <code>v</code>.

        <p>The values of <code>x</code> and <code>v</code> are mutually constrained via noticers so that <code>v</code> is equal
to <code>t</code> if and only if <code>x</code> is known to be numeric and <code>v</code> is equal to <code>nil</code> if and only
if <code>x</code> is known to be non-numeric.

          <ul>
<li>If <code>x</code> later becomes known to be numeric, a noticer attached to <code>x</code> restricts <code>v</code>
  to equal <code>t</code>. Likewise, if <code>x</code> later becomes known to be non-numeric, a noticer
  attached to <code>x</code> restricts <code>v</code> to equal <code>nil</code>.

          <li>If <code>v</code> ever becomes known
  to equal <code>t</code> then a noticer attached to <code>v</code> restricts <code>x</code> to be numeric. Likewise,
  if <code>v</code> ever becomes known to equal <code>nil</code> then a noticer attached to <code>v</code> restricts <code>x</code>
  to be non-numeric. 
</ul>
        </p></blockquote></div>

   <p><a name="index-realpv-109"></a><a name="Function-realpv"></a>

<div class="defun">
&mdash; Function: <b>realpv</b><var> x<a name="index-realpv-110"></a></var><br>
<blockquote><p>Returns <code>t</code> if <code>x</code> is known to be real, <code>nil</code> if <code>x</code> is known to be non-real,
and otherwise returns a new boolean variable <code>v</code>.

        <p>The values of <code>x</code> and <code>v</code> are mutually constrained via noticers so that <code>v</code> is equal
to <code>t</code> if and only if <code>x</code> is known to be real and <code>v</code> is equal to <code>nil</code> if and only if
<code>x</code> is known to be non-real.

          <ul>
<li>If <code>x</code> later becomes known to be real, a noticer attached to <code>x</code> restricts <code>v</code> to
  equal <code>t</code>. Likewise, if <code>x</code> later becomes known to be non-real, a noticer
  attached to <code>x</code> restricts <code>v</code> to equal <code>nil</code>.

          <li>If <code>v</code> ever becomes known to equal <code>t</code> then a noticer attached to <code>v</code> restricts <code>x</code>
  to be real. Likewise, if <code>v</code> ever becomes known to equal <code>nil</code> then a noticer
  attached to <code>v</code> restricts <code>x</code> to be non-real. 
</ul>
        </p></blockquote></div>

   <p><a name="index-integerpv-111"></a><a name="Function-integerpv"></a>

<div class="defun">
&mdash; Function: <b>integerpv</b><var> x<a name="index-integerpv-112"></a></var><br>
<blockquote><p>Returns <code>t</code> if <code>x</code> is known to be integer valued, and <code>nil</code> if <code>x</code> is known be
non-integer value.

        <p>If it is not known whether or not <code>x</code> is integer valued when <code>integerpv</code> is called
then <code>integerpv</code> creates and returns a new boolean variable <code>v</code>.

        <p>The values of <code>x</code> and <code>v</code> are mutually constrained via noticers so that <code>v</code> is equal
to <code>t</code> if and only if <code>x</code> is known to be integer valued, and <code>v</code> is equal to <code>nil</code> if
and only if <code>x</code> is known to be non-integer valued.

        <p>If <code>x</code> later becomes known to be integer valued, a noticer attached to <code>x</code>
restricts <code>v</code> to equal <code>t</code>. Likewise, if <code>x</code> later becomes known to be non-integer
valued, a noticer attached to <code>x</code> restricts <code>v</code> to equal <code>nil</code>.

        <p>Furthermore, if <code>v</code> ever becomes known to equal <code>t</code> then a noticer attached to <code>v</code>
restricts <code>x</code> to be integer valued. Likewise, if <code>v</code> ever becomes known to equal
<code>nil</code> then a noticer attached to <code>v</code> restricts <code>x</code> to be non-integer valued. 
</p></blockquote></div>

   <p><a name="index-minv-113"></a><a name="Function-minv"></a>

<div class="defun">
&mdash; Function: <b>minv</b><var> x &amp;rest xs<a name="index-minv-114"></a></var><br>
<blockquote><p>Constrains its arguments to be real. If called with a single argument,
returns its value. If called with multiple arguments, behaves as if a
combination of two argument calls:

     <pre class="lisp">            (MINV X1 X2 ... Xn) == (MINV (MINV X1 X2) ... Xn)
</pre>
        <p>If called with two arguments, and either is known to be less than or equal to
the other, returns the value of that argument. Otherwise returns a real variable
<code>v</code>, mutually constrained with the arguments:

          <ul>
<li>Minimum of the values of X1 and X2 is constrained to equal <code>v</code>. This
    includes constraining their bounds appropriately. If it becomes know that
    cannot be true. <code>fail</code> is called.

          <li>If both arguments are integers, <code>v</code> is constrained to be an integer. 
</ul>
        </p></blockquote></div>

   <p><a name="index-maxv-115"></a><a name="Function-maxv"></a>

<div class="defun">
&mdash; Function: <b>maxv</b><var> x &amp;rest xs<a name="index-maxv-116"></a></var><br>
<blockquote><p>Constrains its arguments to be real. If called with a single argument,
returns its value. If called with multiple arguments, behaves as if a
combination of two argument calls:

     <pre class="lisp">            (MAXV X1 X2 ... Xn) == (MAXV (MAXV X1 X2) ... Xn)
</pre>
        <p>If called with two arguments, and either is known to be greater than or equal
to the other, returns the value of that argument. Otherwise returns a real
variable <code>v</code>, mutually constrained with the arguments:

          <ul>
<li>Maximum of the values of X1 and X2 is constrained to equal <code>v</code>. This
    includes constraining their bounds appropriately. If it becomes know that
    cannot be true. <code>fail</code> is called.

          <li>If both arguments are integers, <code>v</code> is constrained to be an integer. 
</ul>
        </p></blockquote></div>

   <p><a name="index-g_t_002bv-117"></a><a name="Function-_002bv"></a>

<div class="defun">
&mdash; Function: <b>+v</b><var> &amp;rest xs<a name="index-g_t_002bv-118"></a></var><br>
<blockquote><p>Constrains its arguments to be numbers. Returns 0 if called with no
arguments. If called with a single argument, returns its value. If called with
more than two arguments, behaves as nested sequence of two-argument calls:

     <pre class="lisp">            (+V X1 X2 ... Xn) = (+V X1 (+V X2 (+V ...)))
</pre>
        <p>When called with two arguments, if both arguments are bound, returns the sum
of their values. If either argument is known to be zero, returns the value of
the remaining argument. Otherwise returns number variable <code>v</code>.

          <ul>
<li>Sum of X1 and X2 is constrained to equal <code>v</code>. This includes constraining
    their bounds appropriately. If it becomes known that cannot be true, <code>fail</code>
    is called.

          <li>If both arguments are known to be reals, <code>v</code> is constrained to be real.

          <li>If both arguments are known to be integers, <code>v</code> is constained to be integer.

          <li>If one argument is known to be a non-integer, and the other is known to
    be a real, <code>v</code> is constrained to be a non-integer.

          <li>If one argument is known to be a non-real, and the other is known
    to be a real, <code>v</code> is constrained to be non-real.

        </ul>
        Note: Numeric contagion rules of Common Lisp are not applied if either
argument equals zero. 
</p></blockquote></div>

   <p><a name="index-g_t_002dv-119"></a><a name="Function-_002dv"></a>

<div class="defun">
&mdash; Function: <b>-v</b><var> x &amp;rest xs<a name="index-g_t_002dv-120"></a></var><br>
<blockquote><p>Constrains its arguments to be numbers. If called with a single argument,
behaves as if the two argument call:

     <pre class="lisp">            (-V 0 X)
</pre>
        <p>If called with more than two arguments, behaves as nested sequence of
two-argument calls:

     <pre class="lisp">            (-V X1 X2 ... Xn) = (-V X1 (-V X2 (-V ...)))
</pre>
        <p>When called with two arguments, if both arguments are bound, returns the
difference of their values. If X2 is known to be zero, returns the value of
X1. Otherwise returns number variable <code>v</code>.

          <ul>
<li>Difference of X1 and X2 is constrained to equal <code>v</code>. This includes
    constraining their bounds appropriately. If it becomes known that cannot
    be true, <code>fail</code> is called.

          <li>If both arguments are known to be reals, <code>v</code> is constrained to be real.

          <li>If both arguments are known to be integers, <code>v</code> is constained to be integer.

          <li>If one argument is known to be a non-integer, and the other is known to
    be a real, <code>v</code> is constrained to be a non-integer.

          <li>If one argument is known to be a non-real, and the other is known
    to be a real, <code>v</code> is constrained to be non-real.

        </ul>
        Note: Numeric contagion rules of Common Lisp are not applied if X2 equals zero. 
</p></blockquote></div>

   <p><a name="index-g_t_002av-121"></a><a name="Function-_002av"></a>

<div class="defun">
&mdash; Function: <b>*v</b><var> &amp;rest xs<a name="index-g_t_002av-122"></a></var><br>
<blockquote><p>Constrains its arguments to be numbers. If called with no arugments,
returns 1. If called with a single argument, returns its value. If called with
more than two arguments, behaves as nested sequence of two-argument calls:

     <pre class="lisp">            (*V X1 X2 ... Xn) = (*V X1 (*V X2 (*V ...)))
</pre>
        <p>When called with two arguments, if both arguments are bound, returns the
product of their values. If either argument is known to equal zero, returns
zero. If either argument is known to equal one, returns the value of the other. 
Otherwise returns number variable <code>v</code>.

          <ul>
<li>Product of X1 and X2 is constrained to equal <code>v</code>. This includes constraining
    their bounds appropriately. If it becomes known that cannot be true, <code>fail</code>
    is called.

          <li>If both arguments are known to be reals, <code>v</code> is constrained to be real.

          <li>If both arguments are known to be integers, <code>v</code> is constained to be integer.

          <li>If <code>v</code> is known to be an integer, and either X1 or X2 is known to be real,
    both X1 and X2 are constrained to be integers.

          <li>If <code>v</code> is known to be an reals, and either X1 or X2 is known to be real,
    both X1 and X2 are constrained to be reals.

        </ul>
        Note: Numeric contagion rules of Common Lisp are not applied if either
argument equals zero or one. 
</p></blockquote></div>

   <p><a name="index-g_t_002fv-123"></a><a name="Function-_002fv"></a>

<div class="defun">
&mdash; Function: <b>/v</b><var> x &amp;rest xs<a name="index-g_t_002fv-124"></a></var><br>
<blockquote><p>Constrains its arguments to be numbers. If called with a single argument,
behaves as the two argument call:

     <pre class="lisp">            (/V 1 X)
</pre>
        <p>If called with more than two arguments, behaves as nested sequence of
two-argument calls:

     <pre class="lisp">            (/V X1 X2 ... Xn) = (/V ... (/V (/V X1 X2) X3) ... Xn)
</pre>
        <p>When called with two arguments, if both arguments are bound, returns the
division of their values. If X1 is known to equal zero, returns 0. If X2 is
known to equal zero, <code>fail</code> is called. If X2 is known to equal one, returns the
value of X1. Otherwise returns number variable <code>v</code>.

          <ul>
<li>Division of X1 and X2 is constrained to equal <code>v</code>. This includes
    constraining their bounds appropriately. If it becomes known that cannot
    be true, <code>fail</code> is called.

          <li>If both arguments are known to be reals, <code>v</code> is constrained to be real.

          <li>If both arguments are known to be integers, <code>v</code> is constained to be integer.

          <li>If <code>v</code> is known to be an integer, and either X1 or X2 is known to be real,
    both X1 and X2 are constrained to be integers.

          <li>If <code>v</code> is known to be an reals, and either X1 or X2 is known to be real,
    both X1 and X2 are constrained to be reals.

        </ul>
        Note: Numeric contagion rules of Common Lisp are not applied if X1 equals zero
or X2 equals one. 
</p></blockquote></div>

   <p><a name="index-g_t_003cv-125"></a><a name="Function-_003cv"></a>

<div class="defun">
&mdash; Function: <b>&lt;v</b><var> x &amp;rest xs<a name="index-g_t_003cv-126"></a></var><br>
<blockquote><p>Returns a boolean value which is constrained to be <code>t</code> if each argument Xi is
less than the following argument Xi+1 and constrained to be <code>nil</code> if some
argument Xi is greater than or equal to the following argument Xi+1.

        <p>This function takes one or more arguments. All of the arguments are restricted
to be real.

        <p>Returns <code>t</code> when called with one argument. A call such as <code>(&lt;v x1 x2 ... xn)</code>
with more than two arguments behaves like a conjunction of two argument calls:

     <pre class="lisp">            (ANDV (&lt;V X1 X2) ... (&lt;V Xi Xi+1 ) ... (&lt;V Xn-1 Xn))
</pre>
        <p>When called with two arguments, returns <code>t</code> if X1 is known to be less than X2 at
the time of call, <code>nil</code> if X1 is known to be greater than or equal to X2 at the
time of call, and otherwise a new boolean variable <code>v</code>.

        <p>A real value X1 is known to be less than a real value X2 if X1 has an upper
bound, X2 has a lower bound and the upper bound of X1 is less than the lower
bound of X2.

        <p>A real value X1 is known to be greater than or equal to a real value X2 if X1
has a lower bound, X2 has an upper bound and the lower bound of X1 is greater
than or equal to the upper bound of X2.

        <p>When a new variable is created, the values of X1, X2 and v are mutually
constrained via noticers so that <code>v</code> is equal to <code>t</code> if and only if X1 is known to
be less than X2 and <code>v</code> is equal to <code>nil</code> if and only if X1 is known to be greater
than or equal to X2.

          <ul>
<li>If it later becomes known that X1 is less than X2, noticers attached to X1
  and X2 restrict <code>v</code> to equal <code>t</code>. Likewise, if it later becomes known that X1 is
  greater than or equal to X2, noticers attached to X1 and X2 restrict <code>v</code> to
  equal <code>nil</code>.

          <li>If <code>v</code> ever becomes known to equal <code>t</code> then a noticer attached to <code>v</code> restricts X1
  to be less than X2. Likewise, if <code>v</code> ever becomes known to equal <code>nil</code> then a
  noticer attached to <code>v</code> restricts X1 to be greater than or equal to X2.

        </ul>
        Restricting a real value X1 to be less than a real value X2 is performed by
attaching noticers to X1 and X2. The noticer attached to X1 continually
restricts the lower bound of X2 to be no lower than the upper bound of X1 if
X1 has an upper bound. The noticer attached to X2 continually restricts the
upper bound of X1 to be no higher than the lower bound of X2 if X2 has a lower
bound. Since these restrictions only guarantee that X1 be less than or equal
to X2, the constraint that X1 be strictly less than X2 is enforced by having
the noticers fail when both X1 and X2 become known to be equal.

        <p>Restricting a real value X1 to be greater than or equal to a real value X2 is
performed by an analogous set of noticers without this last equality check. 
</p></blockquote></div>

   <p><a name="index-g_t_003c_003dv-127"></a><a name="Function-_003c_003dv"></a>

<div class="defun">
&mdash; Function: <b>&lt;=v</b><var> x &amp;rest xs<a name="index-g_t_003c_003dv-128"></a></var><br>
<blockquote><p>All arguments are constrained to be real. Returns <code>t</code> when called with one
argument. A call such as <code>(&lt;=v x1 x2 ... xn) </code>with more than two arguments
behaves like a conjunction of two argument calls:

     <pre class="lisp">            (ANDV (&lt;=V X1 X2) ... (&lt;=V Xi Xi+1) ... (&lt;=V Xn-1 Xn))
</pre>
        <p>When called with two arguments, returns <code>t</code> if X1 is know to be less than or equal to X2
at the time of the call, <code>nil</code> if X1 is known to be greater than X2, and otherwise a new
boolean variable <code>v</code>.

        <p>Values of <code>v</code>, X1, and X2 are mutually constrained:

          <ul>
<li><code>v</code> is equal to <code>t</code> iff X1 is known to be less than or equal to X2.

          <li><code>v</code> is equal to <code>nil</code> iff X2 is known to be greater than X2.

          <li>If <code>v</code> is known to be <code>t</code>, X1 is constrained to be less than or equal to X2.

          <li>If <code>v</code> is known to be <code>nil</code>, X1 is constrained to be greater than X2. 
</ul>
        </p></blockquote></div>

   <p><a name="index-g_t_003dv-129"></a><a name="Function-_003dv"></a>

<div class="defun">
&mdash; Function: <b>=v</b><var> x &amp;rest xs<a name="index-g_t_003dv-130"></a></var><br>
<blockquote><p>Returns a boolean value which is constrained to be <code>t</code> if all of the
arguments are numerically equal, and constrained to be <code>nil</code> if two or more of
the arguments numerically differ.

        <p>This function takes one or more arguments. All of the arguments are restricted
to be numeric.

        <p>Returns <code>t</code> when called with one argument. A call such as <code>(=v x1 x2 ... xn)</code>
with more than two arguments behaves like a conjunction of two argument calls:

     <pre class="lisp">            (ANDV (=V X1 X2) ... (=V Xi Xi+1) ... (=V Xn-1 Xn))
</pre>
        <p>When called with two arguments, returns <code>t</code> if X1 is known to be equal to X2 at
the time of call, <code>nil</code> if X1 is known not to be equal to X2 at the time of
call, and a new boolean variable <code>v</code> if is not known if the two values are
equal.

        <p>Two numeric values are known to be equal only when they are both bound and
equal according to the Common Lisp function <code>=</code>.

        <p>Two numeric values are known not to be equal when their domains are disjoint. 
Furthermore, two real values are known not to be equal when their ranges are
disjoint, i.e. the upper bound of one is greater than the lower bound of the
other.

        <p>When a new variable is created, the values of X1, X2, and <code>v</code> are mutually
constrained via noticers so that <code>v</code> is equal to <code>t</code> if and only if X1 is known to
be equal to X2, and <code>v</code> is equal to <code>nil</code> if and only if X1 is known not to be
equal to X2.

          <ul>
<li>If it later becomes known that X1 is equal to X2 noticers attached to X1 and
  X2 restrict <code>v</code> to equal <code>t</code>. Likewise if it later becomes known that X1 is not
  equal to X2 noticers attached to X1 and X2 restrict <code>v</code> to equal <code>nil</code>.

          <li>If <code>v</code> ever becomes known to equal <code>t</code> then a noticer attached to <code>v</code> restricts X1
  to be equal to X2. Likewise if <code>v</code> ever becomes known to equal <code>nil</code> then a
  noticer attached to <code>v</code> restricts X1 not to be equal to X2.

          <li>If X1 is known to be real then the noticer attached to X2 continually
  restrict the upper bound of X1 to be no higher than the upper bound of X2
  and the lower bound of X1 to be no lower than the lower bound of X2. 
  Likewise for bounds of X1 if X2 is known to be real.

        </ul>
        Restricting two values x1 and x2 to be equal is performed by attaching
noticers to x1 and x2. These noticers continually restrict the domains of x1
and x2 to be equivalent sets (using the Common Lisp function <code>=</code> as a test
function) as their domains are restricted.

        <p>Restricting two values X1 and X2 to not be equal is also performed by
attaching noticers to X1 and X2. These noticers however do not restrict the
domains or ranges of X1 or X2. They simply monitor their continually
restrictions and fail when any assertion causes X1 to be known to be equal to
X2. 
</p></blockquote></div>

   <p><a name="index-g_t_003e_003dv-131"></a><a name="Function-_003e_003dv"></a>

<div class="defun">
&mdash; Function: <b>&gt;=v</b><var> x &amp;rest xs<a name="index-g_t_003e_003dv-132"></a></var><br>
<blockquote><p>All arguments are constrained to be real. Returns <code>t</code> when called
with one argument. A call such as <code>(&gt;=v x1 x2 ... xn) </code>with more than two
arguments behaves like a conjunction of two argument calls:

     <pre class="lisp">            (ANDV (&gt;=V X1 X2) ... (&gt;=V Xi Xi+1) ... (&gt;=V Xn-1 Xn))
</pre>
        <p>When called with two arguments, returns <code>t</code> if X1 is know to be greater than or
equal to X2 at the time of the call, <code>nil</code> if X1 is known to be less than X2,
and otherwise a new boolean variable <code>v</code>.

        <p>Values of <code>v</code>, X1, and X2 are mutually constrained:

          <ul>
<li><code>v</code> is equal to <code>t</code> iff X1 is known to be greater than or equal to X2.

          <li><code>v</code> is equal to <code>nil</code> iff X2 is know to be less than X2.

          <li>If <code>v</code> is known to be <code>t</code>, X1 is constrained to be greater than or equal to X2.

          <li>If <code>v</code> is known to be <code>nil</code>, X1 is constrained to be less than X2. 
</ul>
        </p></blockquote></div>

   <p><a name="index-g_t_003ev-133"></a><a name="Function-_003ev"></a>

<div class="defun">
&mdash; Function: <b>&gt;v</b><var> x &amp;rest xs<a name="index-g_t_003ev-134"></a></var><br>
<blockquote><p>All arguments are constrained to be real. Returns <code>t</code> when called with one
argument. A call such as <code>(&gt;v x1 x2 ... xn) </code>with more than two arguments
behaves like a conjunction of two argument calls:

     <pre class="lisp">            (ANDV (&gt; X1 X2) ... (&gt; Xi Xi+1) ... (&gt; Xn-1 Xn))
</pre>
        <p>When called with two arguments, returns <code>t</code> if X1 is know to be greater than X2
at the time of the call, <code>nil</code> if X1 is known to be less than or equal to X2,
and otherwise a new boolean variable <code>v</code>.

        <p>Values of <code>v</code>, X1, and X2 are mutually constrained:

          <ul>
<li><code>v</code> is equal to <code>t</code> iff X1 is known to be greater than X2.

          <li><code>v</code> is equal to <code>nil</code> iff X2 is known to be less than or equal to X2.

          <li>If <code>v</code> is known to be <code>t</code>, X1 is constrained to be greater than X2.

          <li>If <code>v</code> is known to be <code>nil</code>, X1 is constrained to be less than or equal to X2. 
</ul>
        </p></blockquote></div>

   <p><a name="index-g_t_002f_003dv-135"></a><a name="Function-_002f_003dv"></a>

<div class="defun">
&mdash; Function: <b>/=v</b><var> x &amp;rest xs<a name="index-g_t_002f_003dv-136"></a></var><br>
<blockquote><p>Returns a boolean value which is constrained to be <code>t</code> if no two arguments
are numerically equal, and constrained to be <code>nil</code> if any two or more arguments
are numerically equal.

        <p>This function takes one or more arguments. All of the arguments are restricted
to be numeric.

        <p>Returns <code>t</code> when called with one argument. A call such as <code>(/=v x1 x2 ... xn)</code>
with more than two arguments behaves like a conjunction of two argument calls:

     <pre class="lisp">            (ANDV (/=V X1 X2) ... (/=V X1 Xn)
                  (/=V X2 X3) ... (/=V X2 Xn)
                  ...
                  (/=V Xi Xi+1 ... (/=V Xi Xn)
                  ...
                  (/=V Xn-1 xn))
</pre>
        <p>When called with two arguments, returns <code>t</code> if X1 is known not to be equal to X2
at the time of call, <code>nil</code> if X1 is known to be equal to X2 at the time of
call, and otherwise a new boolean variable <code>v</code>.

        <p>Two numeric values are known not to be equal when their domains are disjoint.

        <p>Two real values are known not to be equal when their ranges are disjoint, i.e. 
the upper bound of one is greater than the lower bound of the other.

        <p>Two numeric values are known to be equal only when they are both bound and
equal according to the Common Lisp function <code>=</code>.

        <p>When a new variable is created, the values of X1, X2 and <code>v</code> are mutually
constrained via noticers so that <code>v</code> is equal to <code>t</code> if and only if X1 is known
not to be equal to X2 and <code>v</code> is equal to <code>nil</code> if and only if X1 is known to be
equal to X2.

          <ul>
<li>If it later becomes known that X1 is not equal to X2, noticers attached to
  X1 and X2 restrict <code>v</code> to equal <code>t</code>. Likewise, if it later becomes known that X1
  is equal to X2, noticers attached to X1 and X2 restrict <code>v</code> to equal <code>nil</code>.

          <li>If <code>v</code> ever becomes known to equal <code>t</code> then a noticer attached to <code>v</code> restricts X1
  to not be equal to X2. Likewise, if <code>v</code> ever becomes known to equal <code>nil</code> then a
  noticer attached to <code>v</code> restricts X1 to be equal to X2.

        </ul>
        Restricting two values X1 and X2 to be equal is performed by attaching
noticers to X1 and X2. These noticers continually restrict the domains of X1
and X2 to be equivalent sets (using the Common Lisp function <code>=</code> as a test
function) as their domains are restricted. Furthermore, if X1 is known to be
real then the noticer attached to X2 continually restrict the upper bound of
X1 to be no higher than the upper bound of X2 and the lower bound of X1 to be
no lower than the lower bound of X2. The noticer of X2 performs a symmetric
restriction on the bounds of X1 if it is known to be real.

        <p>Restricting two values X1 and X2 to not be equal is also performed by
attaching noticers to X1 and X2. These noticers however, do not restrict the
domains or ranges of X1 or X2. They simply monitor their continually
restrictions and fail when any assertion causes X1 to be known to be equal to
X2. 
</p></blockquote></div>

<h4 class="subsection">4.2.5 Forcing Solutions</h4>

<p><a name="index-solution-137"></a><a name="Function-solution"></a>

<div class="defun">
&mdash; Function: <b>solution</b><var> arguments ordering-force-function<a name="index-solution-138"></a></var><br>
<blockquote><p><code>arguments</code> is a list of values. Typically it is a list of
variables but it may also contain nonvariables.

        <p>The specified <code>ordering-force-function</code> is used to force each of the variables
in list to be bound.

        <p>Returns a list of the values of the elements of list in the same order that
they appear in list, irrespective of the forcing order imposed by the
<code>ordering-force-function</code>.

        <p>The <code>ordering-force-function</code> can be any function which takes a list of values
as its single argument that is guaranteed to force all variables in that list
to be bound upon its return. The returned value of the <code>ordering-force-function</code>
is ignored.

        <p>The user can construct her own <code>ordering-force-function</code> or use one of the
following alternatives provided with Screamer:

     <pre class="lisp">             (STATIC-ORDERING #'LINEAR-FORCE),
             (STATIC-ORDERING #'DIVIDE-AND-CONQUER-FORCE),
             (REORDER COST-FUN TERMINATE-TEST ORDER #'LINEAR-FORCE) and
             (REORDER COST-FUN TERMINATE-TEST ORDER #'DIVIDE-AND-CONQUER-FORCE).
</pre>
        <p>Future implementation of Screamer may provide additional forcing and ordering
functions. 
</p></blockquote></div>

   <p><a name="index-static_002dordering-139"></a><a name="Function-static_002dordering"></a>

<div class="defun">
&mdash; Function: <b>static-ordering</b><var> force-function<a name="index-static_002dordering-140"></a></var><br>
<blockquote><p>Returns an ordering force function based on <code>force-function</code>.

        <p>The ordering force function which is returned is a nondeterministic function
which takes a single argument <code>x</code>. This argument <code>x</code> can be a list of values where
each value may be either a variable or a non-variable. The ordering force
function applies the <code>force-function</code> in turn to each of the variables in <code>x</code>, in
the order that they appear, repeatedly applying the <code>force-function</code> to a given
variable until it becomes bound before proceeding to the next variable. The
ordering force function does not return any meaningful result.

        <p><code>force-function</code> is any (potentially nondeterministic) function which can be
applied to a variable as its single argument with the stipulation that a
finite number of repeated applications will force the variable to be bound. 
The <code>force-function</code> need not return any useful value.

        <p>Screamer currently provides two convenient force-functions, namely
<code>#'linear-force</code> and <code>#'divide-and-conquer-force</code> though future implementations
may provide additional ones. (The defined Screamer protocol does not provide
sufficient hooks for the user to define her own force functions.) 
</p></blockquote></div>

   <p><a name="index-reorder-141"></a><a name="Function-reorder"></a>

<div class="defun">
&mdash; Function: <b>reorder</b><var> cost-function terminate? order force-function<a name="index-reorder-142"></a></var><br>
<blockquote><p>Returns an ordering force function based on arguments.

        <p>The <code>force-function</code> is any (potentially nondeterministic) function
which can be applied to a variable as its single argument with the
stipulation that a finite number of repeated applications will force
the variable to be bound. The <code>force-function</code> need not return any useful value.

        <p>The ordering force function which is returned is a nondeterministic function
which takes a single argument <code>x</code>. This argument <code>x</code> can be a list of values where
each value may be either a variable or a non-variable.

        <p>The ordering force function repeatedly selects a "best" variable using using
<code>cost-function</code> and <code>order</code>. Eg. using <code>#'domain-size</code> and <code>#'&lt;</code> as the <code>cost-function</code>
and <code>order</code>, then the variable with the smallest domain will be forced first.

        <p>Function <code>terminate</code>? is then called with the determined cost of that variable,
and unless it returns true, <code>force-function</code> is applied to that variable to
force constrain it.

        <p>Process then iterates until all variables become bound or <code>terminate</code>? returns
true.

        <p>The ordering force function does not return any meaningful result.

        <p>Screamer currently provides two convenient force-functions, namely
#'linear-force and #'divide-and-conquer-force though future implementations
may provide additional ones. (The defined Screamer protocol does not provide
sufficient hooks for the user to define her own force functions.) 
</p></blockquote></div>

   <p><a name="index-linear_002dforce-143"></a><a name="Function-linear_002dforce"></a>

<div class="defun">
&mdash; Function: <b>linear-force</b><var> x<a name="index-linear_002dforce-144"></a></var><br>
<blockquote><p>Returns <code>x</code> if it is not a variable. If <code>x</code> is a bound variable then returns
its value.

        <p>If <code>x</code> is an unbound variable then it must be known to have a countable set of
potential values. In this case <code>x</code> is nondeterministically restricted to be
equal to one of the values in this countable set, thus forcing <code>x</code> to be bound. 
The dereferenced value of <code>x</code> is then returned.

        <p>An unbound variable is known to have a countable set of potential values
either if it is known to have a finite domain or if it is known to be integer
valued.

        <p>An error is signalled if <code>x</code> is not known to have a finite domain and is not
known to be integer valued.

        <p>Upon backtracking <code>x</code> will be bound to each potential value in turn, failing
when there remain no untried alternatives.

        <p>Since the set of potential values is required only to be countable, not
finite, the set of untried alternatives may never be exhausted and
backtracking need not terminate. This can happen, for instance, when <code>x</code> is
known to be an integer but lacks either an upper of lower bound.

        <p>The order in which the nondeterministic alternatives are tried is left
unspecified to give future implementations leeway in incorporating heuristics
in the process of determining a good search order. 
</p></blockquote></div>

   <p><a name="index-divide_002dand_002dconquer_002dforce-145"></a><a name="Function-divide_002dand_002dconquer_002dforce"></a>

<div class="defun">
&mdash; Function: <b>divide-and-conquer-force</b><var> variable<a name="index-divide_002dand_002dconquer_002dforce-146"></a></var><br>
<blockquote><p>Returns <code>x</code> if <code>x</code> is not a variable. If <code>x</code> is a bound variable then returns its
value. Otherwise implements a single binary-branching step of a
divide-and-conquer search algorithm. There are always two alternatives, the
second of which is tried upon backtracking.

        <p>If it is known to have a finite domain <code>d</code> then this domain is split into two
halves and the value of <code>x</code> is nondeterministically restricted to be a member
one of the halves. If <code>x</code> becomes bound by this restriction then its value is
returned. Otherwise, <code>x</code> itself is returned.

        <p>If <code>x</code> is not known to have a finite domain but is known to be real and to have
both lower and upper bounds then nondeterministically either the lower or
upper bound is restricted to the midpoint between the lower and upper bound. 
If <code>x</code> becomes bound by this restriction then its dereferenced value is
returned. Otherwise, <code>x</code> itself is returned.

        <p>An error is signalled if <code>x</code> is not known to be restricted to a finite domain
and either is not known to be real or is not known to have both a lower and
upper bound.

        <p>When the set of potential values may be infinite, users of
<code>divide-and-conquer-force</code> may need to take care to fail when the range size of
the variable becomes too small, unless other constraints on it are sufficient
to guarentee failure.

        <p>The method of splitting the domain into two halves is left unspecified to give
future implementations leeway in incorporating heuristics in the process of
determining a good search order. All that is specified is that if the domain
size is even prior to splitting, the halves are of equal size, while if the
domain size is odd, the halves differ in size by at most one. 
</p></blockquote></div>

   <p><a name="index-domain_002dsize-147"></a><a name="Function-domain_002dsize"></a>

<div class="defun">
&mdash; Function: <b>domain-size</b><var> x<a name="index-domain_002dsize-148"></a></var><br>
<blockquote><p>Returns the domain size of <code>x</code>.

        <p>If <code>x</code> is an integer variable with an upper and lower bound, its domain size
is the one greater than the difference of its bounds. Eg. [integer 1:2] has
domain size 2.

        <p>If <code>x</code> is a variable with an enumerated domain, its domain size is the size of
that domain.

        <p>If <code>x</code> is a <code>cons</code>, or a variable whose value is a <code>cons</code>, its domain size is the
product of the domain sizes of its <code>car</code> and <code>cdr</code>.

        <p>Other types of unbound variables have domain size <code>nil</code>, whereas non-variables
have domain size of 1. 
</p></blockquote></div>

   <p><a name="index-range_002dsize-149"></a><a name="Function-range_002dsize"></a>

<div class="defun">
&mdash; Function: <b>range-size</b><var> x<a name="index-range_002dsize-150"></a></var><br>
<blockquote><p>Returns the range size of <code>x</code>. Range size is the size of the range values
of <code>x</code> may take.

        <p>If <code>x</code> is an integer or a bound variable whose value is an integer, it has the
range size 0. Reals and bound variables whose values are reals have range size
0.0.

        <p>Unbound variables known to be reals with an upper and lower bound have a range
size the difference of their upper and lower bounds.

        <p>Other types of objects and variables have range size <code>nil</code>. 
</p></blockquote></div>

<h3 class="section">4.3 Miscellany</h3>

<p><a name="index-define_002dscreamer_002dpackage-151"></a><a name="Macro-define_002dscreamer_002dpackage"></a>

<div class="defun">
&mdash; Macro: <b>define-screamer-package</b><var> defined-package-name &amp;body options<a name="index-define_002dscreamer_002dpackage-152"></a></var><br>
<blockquote><p>Convenience wrapper around <code>defpackage</code>. Passes its argument directly
to <code>defpackage</code>, and automatically injects two additional options:

     <pre class="lisp">              (:shadowing-import-from :screamer :defun :multiple-value-bind :y-or-n-p)
              (:use :cl :screamer)
</pre>
        </blockquote></div>

   <p><a name="index-best_002dvalue-153"></a><a name="Macro-best_002dvalue"></a>

<div class="defun">
&mdash; Macro: <b>best-value</b><var> form1 objective-form &amp;optional form2<a name="index-best_002dvalue-154"></a></var><br>
<blockquote><p>First evaluates <code>objective-form</code>, which should evaluate to constraint variable <code>v</code>.

        <p>Then repeatedly evaluates FORM1 in non-deterministic context till it fails. If
previous round of evaluation produced an upper bound <code>b</code> for <code>v</code>, the during the
next round any change to <code>v</code> must provide an upper bound higher than <code>b</code>, or that
that change fails.

        <p>If the last successful evaluation of <code>form</code> produced an upper bound for <code>v</code>,
returns a list of two elements: the the primary value of FORM1 from that
round, and the upper bound of <code>v</code>.

        <p>Otherwise if FORM2 is provided, returns the result of evaluating it, or else
calls fails.

        <p>Note: this documentation string is entirely reverse-engineered. Lacking
information on just how <code>best-value</code> was intended to work, it is hard to tell
what is a bug, an accident of implementation, and what is a feature. If you
have any insight into <code>best-value</code>, please send email to
nikodemus@random-state.net. 
</p></blockquote></div>

   <p><a name="index-booleanp-155"></a><a name="Function-booleanp"></a>

<div class="defun">
&mdash; Function: <b>booleanp</b><var> x<a name="index-booleanp-156"></a></var><br>
<blockquote><p>Returns true iff <code>x</code> is <code>t</code> or <code>nil</code>. 
</p></blockquote></div>

   <p><a name="index-count_002dtrues-157"></a><a name="Function-count_002dtrues"></a>

<div class="defun">
&mdash; Function: <b>count-trues</b><var> &amp;rest xs<a name="index-count_002dtrues-158"></a></var><br>
<blockquote><p>Returns the number of time a non-NIL value occurs in its arguments. 
</p></blockquote></div>

   <p><a name="index-purge-159"></a><a name="Function-purge"></a>

<div class="defun">
&mdash; Function: <b>purge</b><var> function-name<a name="index-purge-160"></a></var><br>
<blockquote><p>Removes any information about <code>function-name</code> from Screamer's
who-calls database. 
</p></blockquote></div>

   <p><a name="index-unwind_002dtrail-161"></a><a name="Function-unwind_002dtrail"></a>

<div class="defun">
&mdash; Function: <b>unwind-trail</b><var><a name="index-unwind_002dtrail-162"></a></var><br>
<blockquote><p><code>deprecated</code>.

        <p>Calls all functions installed using <code>trail</code>, and removes them from the trail.

        <p>Using <code>unwind-trail</code> is dangerous, as <code>trail</code> is used by Screamer internally to
eg. undo effects of local assignments <code>--</code> hence users should never call it. It
is provided at the moment only for backwards compatibility with classic
Screamer. 
</p></blockquote></div>

   <p><a name="index-unwedge_002dscreamer-163"></a><a name="Function-unwedge_002dscreamer"></a>

<div class="defun">
&mdash; Function: <b>unwedge-screamer</b><var><a name="index-unwedge_002dscreamer-164"></a></var><br>
<blockquote><p>Removes any information about all user defined functions from
Screamer's who-calls database. 
</p></blockquote></div>

   <p><a name="index-g_t_0040earmuffs_007bdynamic_002dextent_003f_007d-165"></a><a name="Variable-_002adynamic_002dextent_003f_002a"></a>

<div class="defun">
&mdash; Variable: <b>*dynamic-extent?*</b><var><a name="index-g_t_0040earmuffs_007bdynamic_002dextent_003f_007d-166"></a></var><br>
<blockquote><p>Set to <code>t</code> to enable the dynamic extent optimization, <code>nil</code> to
disable it. Default is platform dependent. 
</p></blockquote></div>

   <p><a name="index-g_t_0040earmuffs_007bscreamer_002dversion_007d-167"></a><a name="Variable-_002ascreamer_002dversion_002a"></a>

<div class="defun">
&mdash; Variable: <b>*screamer-version*</b><var><a name="index-g_t_0040earmuffs_007bscreamer_002dversion_007d-168"></a></var><br>
<blockquote><p>The version of Screamer which is loaded. This is currently still 3.20,
while we're considering how to express versions for this copy of Screamer in
the future. 
</p></blockquote></div>

   <p><a name="index-g_t_0040earmuffs_007biscream_003f_007d-169"></a><a name="Variable-_002aiscream_003f_002a"></a>

<div class="defun">
&mdash; Variable: <b>*iscream?*</b><var><a name="index-g_t_0040earmuffs_007biscream_003f_007d-170"></a></var><br>
<blockquote><p><code>t</code> if Screamer is running under ILisp/GNUEmacs with iscream.el loaded. 
</p></blockquote></div>

   <p><a name="index-g_t_0040earmuffs_007bmaximum_002ddiscretization_002drange_007d-171"></a><a name="Variable-_002amaximum_002ddiscretization_002drange_002a"></a>

<div class="defun">
&mdash; Variable: <b>*maximum-discretization-range*</b><var><a name="index-g_t_0040earmuffs_007bmaximum_002ddiscretization_002drange_007d-172"></a></var><br>
<blockquote><p>Discretize integer variables whose range is not greater than this number. 
Discretize all integer variables if <code>nil</code>. Must be an integer or <code>nil</code>. 
</p></blockquote></div>

   <p><a name="index-g_t_0040earmuffs_007bminimum_002dshrink_002dratio_007d-173"></a><a name="Variable-_002aminimum_002dshrink_002dratio_002a"></a>

<div class="defun">
&mdash; Variable: <b>*minimum-shrink-ratio*</b><var><a name="index-g_t_0040earmuffs_007bminimum_002dshrink_002dratio_007d-174"></a></var><br>
<blockquote><p>Ignore propagations which reduce the range of a variable by less than this
ratio. 
</p></blockquote></div>

   <p><a name="index-g_t_0040earmuffs_007bstrategy_007d-175"></a><a name="Variable-_002astrategy_002a"></a>

<div class="defun">
&mdash; Variable: <b>*strategy*</b><var><a name="index-g_t_0040earmuffs_007bstrategy_007d-176"></a></var><br>
<blockquote><p>Strategy to use for <code>funcallv</code> and <code>applyv</code>. Either <code>:gfc</code> for Generalized
Forward Checking, or <code>:ac</code> for Arc Consistency. Default is <code>:gfc</code>. 
</p></blockquote></div>

<div class="node">
<a name="Function-Index"></a>
<p><hr>
Next:&nbsp;<a rel="next" accesskey="n" href="#Variable-Index">Variable Index</a>,
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Dictionary">Dictionary</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h2 class="appendix">Appendix A Function Index</h2>

<ul class="index-fn" compact>
<li><a href="#index-g_t_002av-121"><code>*v</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-g_t_002bv-117"><code>+v</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-g_t_002dv-119"><code>-v</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-g_t_002f_003dv-135"><code>/=v</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-g_t_002fv-123"><code>/v</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-g_t_003c_003dv-127"><code>&lt;=v</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-g_t_003cv-125"><code>&lt;v</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-g_t_003dv-130"><code>=v</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-g_t_003e_003dv-132"><code>&gt;=v</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-g_t_003ev-133"><code>&gt;v</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-a_002dboolean-25"><code>a-boolean</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-a_002dbooleanv-70"><code>a-booleanv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-a_002dmember_002dof-27"><code>a-member-of</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-a_002dmember_002dofv-85"><code>a-member-ofv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-a_002dnumberv-89"><code>a-numberv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-a_002dreal_002dabovev-94"><code>a-real-abovev</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-a_002dreal_002dbelowv-96"><code>a-real-belowv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-a_002dreal_002dbetweenv-98"><code>a-real-betweenv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-a_002drealv-91"><code>a-realv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-all_002dvalues-7"><code>all-values</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-an_002dinteger-30"><code>an-integer</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-an_002dinteger_002dabove-32"><code>an-integer-above</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-an_002dinteger_002dabovev-102"><code>an-integer-abovev</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-an_002dinteger_002dbelow-33"><code>an-integer-below</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-an_002dinteger_002dbelowv-103"><code>an-integer-belowv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-an_002dinteger_002dbetween-36"><code>an-integer-between</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-an_002dinteger_002dbetweenv-105"><code>an-integer-betweenv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-an_002dintegerv-100"><code>an-integerv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-andv-79"><code>andv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-apply_002dnondeterministic-37"><code>apply-nondeterministic</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-apply_002dsubstitution-56"><code>apply-substitution</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-applyv-62"><code>applyv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-assert_0021-51"><code>assert!</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-best_002dvalue-153"><code>best-value</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-booleanp-155"><code>booleanp</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-booleanpv-71"><code>booleanpv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-bound_003f-58"><code>bound?</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-count_002dfailures-48"><code>count-failures</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-count_002dtrues-157"><code>count-trues</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-count_002dtruesv-84"><code>count-truesv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-decide-76"><code>decide</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-define_002dscreamer_002dpackage-151"><code>define-screamer-package</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-divide_002dand_002dconquer_002dforce-145"><code>divide-and-conquer-force</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-domain_002dsize-148"><code>domain-size</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-either-1"><code>either</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-equalv-66"><code>equalv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-fail-3"><code>fail</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-for_002deffects-11"><code>for-effects</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-funcall_002dnondeterministic-39"><code>funcall-nondeterministic</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-funcallv-64"><code>funcallv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-global-22"><code>global</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-ground_003f-59"><code>ground?</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-integerpv-112"><code>integerpv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-ith_002dvalue-13"><code>ith-value</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-known_003f-74"><code>known?</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-linear_002dforce-143"><code>linear-force</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-local-23"><code>local</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-make_002dvariable-49"><code>make-variable</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-maxv-116"><code>maxv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-memberv-88"><code>memberv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-minv-114"><code>minv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-multiple_002dvalue_002dcall_002dnondeterministic-41"><code>multiple-value-call-nondeterministic</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-necessarily_003f-19"><code>necessarily?</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-nondeterministic_002dfunction_003f-44"><code>nondeterministic-function?</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-notv-78"><code>notv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-numberpv-107"><code>numberpv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-one_002dvalue-9"><code>one-value</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-orv-81"><code>orv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-possibly_003f-17"><code>possibly?</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-print_002dvalues-15"><code>print-values</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-purge-160"><code>purge</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-range_002dsize-149"><code>range-size</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-realpv-110"><code>realpv</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-reorder-142"><code>reorder</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-solution-137"><code>solution</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-static_002dordering-139"><code>static-ordering</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-template-67"><code>template</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-trail-6"><code>trail</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-unwedge_002dscreamer-164"><code>unwedge-screamer</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-unwind_002dtrail-162"><code>unwind-trail</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-value_002dof-53"><code>value-of</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-when_002dfailing-45"><code>when-failing</code></a>: <a href="#Dictionary">Dictionary</a></li>
   </ul><div class="node">
<a name="Variable-Index"></a>
<p><hr>
Previous:&nbsp;<a rel="previous" accesskey="p" href="#Function-Index">Function Index</a>,
Up:&nbsp;<a rel="up" accesskey="u" href="#Top">Top</a>

</div>

<!-- node-name,  next,  previous,  up -->
<h2 class="appendix">Appendix B Variable Index</h2>



<ul class="index-vr" compact>
<li><a href="#index-g_t_0040earmuffs_007bdynamic_002dextent_003f_007d-165"><code>*dynamic-extent?*</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-g_t_0040earmuffs_007biscream_003f_007d-169"><code>*iscream?*</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-g_t_0040earmuffs_007bmaximum_002ddiscretization_002drange_007d-171"><code>*maximum-discretization-range*</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-g_t_0040earmuffs_007bminimum_002dshrink_002dratio_007d-174"><code>*minimum-shrink-ratio*</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-g_t_0040earmuffs_007bscreamer_002dversion_007d-167"><code>*screamer-version*</code></a>: <a href="#Dictionary">Dictionary</a></li>
<li><a href="#index-g_t_0040earmuffs_007bstrategy_007d-175"><code>*strategy*</code></a>: <a href="#Dictionary">Dictionary</a></li>
   </ul></body></html>

